

  suite sur les INTERRUPTIONS ...
  πππππππππππππππππππππππππππ



  14) TBCR :Identique Ö TACR, sauf que ce regsitre controle le TIMER B
            ($FFFA1B)

 
  15) TCDCR:Vecteur bit ayant le mäme role que TACR et TBCR pour les
            TIMER C et TIMER D, mais ici seul le  DELAY MODE est dis-
            ponible.
            ($FFFA1D)

            Les bits 0 Ö 2 sont rÇservÇs au TIMER C
            Les bits 4 Ö 6 sont rÇservÇs au TIMER D

            Voir le tableau de TACR pour la signification des bits...

            Je vous rappelle que nous n'utiliserons pas ces TIMERS car
            ils sont dÇjÖ utilisÇs par le systäme Ö l'origine.

  16) Ö 19) TADR,TBDR,TCDR,TDDR (Ö partir de $FFFA1F):

      VoilÖ les registres de DONNêES des 4 TIMERS ...

  20) Ö 24) SRC,CR,RSR,TSR,DR (Ö partir de $AFFF27):

      Des registres qui ne sont pas utilisÇs par les TIMERS, et ils 
      se contentent de controler les Çmissions de caractäres...




  Maintenant que vous ätes familiarisÇ avec les diffÇrents registres
  du MFP 68901, vous pourrez commencer Ö rÇaliser vos premiers pro-
  grammes sous interruption.

  Pour modifier un registre du MFP, il suffit de connaitre l'adresse
  du registre et d'y dÇposer les donnÇes qu'il faut.

 - VoilÖ comment il faut procäder pour mettre une routine sous 
   interruption: 
   
  ππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππ        
  * On passe en MODE SUPERVISEUR pour pouvoir atteindre les registre
    du MFP.
  * On met Ö 0 le bit correspondant au TIMER utilisÇ dans le registre
    IMR.(Avec en AND #BBB,destination ou un BCLR #BBB,destination)
  * On met Ö 0 le bit correspondant au TIMER utilisÇ dans le registre
    ISR.
  * On met Ö 0 le bit correspondant au TIMER utilisÇ dans le registre
    IPR.
  * On met Ö 0 le bit correspondant au TIMER utilisÇ dans le registre
    IER.         
  * On installe notre routine:

   .Soit en dÇposant l'adresse de notre routine directement dans le
    VECTEUR D'EXCEPTION correspondant au TIMER utilisÇ:
    $134 pour le TIMER A, $120 pour le TIMER B, $114 pour le TIMER C,
    $110 pour le TIMER D (avec MOVE.L #ADRESSE,$vecteur)
    (Voir le Tableau des vecteurs d'exception)

    Puis en modifiant directement les REGISTRES DE CONTROLE et DE DONNêE
    du TIMER en dÇposant les nouvelles valeurs aux adresses de ceux-ci.
    (Avec MOVE.B  #VALEUR,$adresse) 
    (Voir les adresses des REGISTRES TACR,TBCR,TCDCR (CONTROLE) et les
    adresses des REGISTRES TADR,TBDR,TCDR,TDDR (DONNêE) )
    
    
   .Soit en appelant une fonction de l'XBIOS qui le fait Ö notre place:
    C'est la fonction XBTIMER de l'XBIOS.
  
    Les paramätres Ö passer sont:

    L-M:Adresse de la routine    
    MOT:Valeur du registre de DONNêE
    MOT:Valeur de registre de CONTROLE
    MOT:Le code du TIMER (0=TIMER A,1=TIMER B,2=TIMER C,3=TIMER D)
    MOT:Code de la fonction = $1F
    
  
   Il faudra encore:

  .Mettre le bit du registre IER correspondant Ö notre TIMER Ö 1 (Pour
   valider notre routine sous interruption) 
  .Mettre le bit du registre IMR correspondant Ö notre TIMER Ö 1 
   
  ππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππππ
   Et voilÖ, ma routine est installÇe !!!

   

   La routine elle màme:
   πππππππππππππππππππππ
   La routine Ö mettre sous interruption devra pouvoir s'exÇcuter 
   entiärement avant l'appel suivant du TIMER car sinon attention
   au plantage !!
   Celle-ci ne devra donc pas àtre trop longue:
   On ne pourra pas par exemple mettre une routine qui demande 0,5 
   secondes pour s'exÇcuter entiärement sous interruption et rägler
   sa frÇquence d'appel Ö 0,007 secondes ...
 
   Votre routine sous interruption devra toujours se terminer par:

    .Une mise Ö 0 du bit correspondant au TIMER utilisÇ du registre ISR
     ,pour indiquer au MFP que la routine se termine.

               ππππππππππππππππππππππππππππππππ
     Avec      BCLR  #5,$FFFA07 pour le TIMER A        (Sur ISRA)
     ou        BLCR  #0,$FFFA11 pour le TIMER B        (Sur ISRB)

               ππππππππππππππππππππππππππππππππ

    .Un RTE (Return From Exception)  
        πππ
  

  De plus, comme votre routine s'exÇcute Ö intervals rÇguliers, je vous
  dÇconseille fortement d'utiliser les registre DN ou AN (mäme SP) car
  ceci peut provoquer des changments brusques au niveaux des registres
  conscernÇs dans la programme principal.(Le programme sous interruption
  s'exÇcutant sans interrompre le programme principal, nous en verrons 
  une träs bonne illustration dans un prochain exercice)

  Le programme sous interruption pourra toutefois faire appel Ö des
  adresses du segment DATA ou BSS pour lire ou dÇposer des valeurs...

  
  
  VoilÖ pour la thÇorie, je vous conseille fortement de relire tout
  le chapitre Ö fond car maintenant viennent les EXERCICES ...


          
                              πππππππππππππππππ

  PIECHOCKI  Laurent
  8,Impasse Bellevue            Suite dans le fichier:EXOS_4.DOC 
  57980  TENTELING                                    ππππππππππ





   

