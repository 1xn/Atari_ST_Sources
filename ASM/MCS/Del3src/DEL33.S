
	OPT O+
start:
	;move.l #$B7000,-(sp)
	;move.w #$20,-(sp)
	;trap #01
	;lea 4(sp),sp	

	clr.l	-(sp)
	move.w	#32,-(sp)
	trap	#1
	addq.l	#6,sp

	DC.W	$A00A
	MOVE.L #0,$4D2
	MOVE.L #0,$4D6
	move.w	#0,$FF8900
	bclr.b #0,$484
	move.w #2,-(a7)
	trap #14
	addq.l #2,a7
	move.l d0,ecran
	move.w #0,-(a7)
	move.l SCREEN,-(a7)
	move.l SCREEN,-(a7)
	move.w #5,-(a7)
	trap #14
	add.l #12,a7
	lea	palette,a0
	lea	$ff8240,a1
	rept 8
	move.l (a0)+,(a1)+
	endr
	PEA	TXT
	MOVE.W #9,-(A7)
	TRAP #1
	ADDQ.L #6,A7
NO	CMP.B #1,$FFFC02
	BNE	NO
	move.l	OLDSCREEN,A0
	MOVE.W #64100/4,D0
CLER	MOVE.L #0,(A0)+
	DBF D0,CLER
	
	
	LEA	BUFFER,A0
	MOVE.W (A0),X1
	MOVE.W (A0),X2
	MOVE.W (A0),X3
	MOVE.W (A0),X4
	MOVE.W (A0),X5
	MOVE.W (A0),X6
	MOVE.W (A0),X7
	MOVE.W (A0),X8
	MOVE.W (A0),X1S
	MOVE.W (A0),X2S
	MOVE.W (A0),X3S
	MOVE.W (A0),X4S
	MOVE.W (A0),X5S
	MOVE.W (A0),X6S
	MOVE.W (A0),X7S
	MOVE.W (A0)+,X8S
	MOVE.W	(A0),Y1
	MOVE.W	(A0),Y2
	MOVE.W	(A0),Y3
	MOVE.W	(A0),Y4
	MOVE.W	(A0),Y5
	MOVE.W	(A0),Y6
	MOVE.W	(A0),Y7
	MOVE.W	(A0),Y8
	MOVE.W	(A0),Y1S
	MOVE.W	(A0),Y2S
	MOVE.W	(A0),Y3S
	MOVE.W	(A0),Y4S
	MOVE.W	(A0),Y5S
	MOVE.W	(A0),Y6S
	MOVE.W	(A0),Y7S
	MOVE.W	(A0),Y8S
	
	move.b $fffa09,SA09
	move.b $fffa07,SA07
	move.b #0,$fffa07
	move.b #0,$fffa09
	JSR	SONG
	MOVE.L	#0,MUSI
	MOVE.W		#1,$FF8920   
	MOVE.L		#MU,D0
	LEA		$FF8901,A0
	MOVEP.L	D0,(A0)
	MOVE.L 	#MUS_END,D0	
	MOVEP.L	D0,12(A0)
	;MOVE.L	#FINDEMOVBL,$4D2
	MOVE.L	#ANIM,$4D2
	move.l	#SONG+8,$4d6
cont	nop
	cmp.b #$39,$fffc02
	BEQ ENDE
	CMP.W #-1,FINI
	BEQ ENDE
	BRA cont

ENDE	move.l	#0,$4d2
	move.l	#0,$4d6
	move.w	#0,$FF8900
	move.b SA09,$fffa09
	move.b SA07,$fffa07
	JMP	$8C
	;dc.w $A009
	;clr.w -(a7)
	;trap #1
SA09	DC.B	0
SA07	DC.B	0

ANIM	MOVE.L SCREEN,A0
	MOVE.L OLDSCREEN,SCREEN
	MOVE.L A0,OLDSCREEN
	MOVE.L	SCREEN,D0
	MOVE.B	D0,$FF8209
	LSR.W	#8,D0
	MOVE.B D0,$FF8207
	MOVE.B	D0,$FF8203
	SWAP	D0
	MOVE.B	D0,$FF8205
	MOVE.B	D0,$FF8201
	ADD.W #1,ATTENTE
	CMP.W #450,ATTENTE
	BEQ	CONTIN
	BRA	prog
CONTIN	MOVE.W #449,ATTENTE
	CMP.W #2,MMAN
	BEQ	TIR
	MOVE.L	TEUR,A0
	CMP.L #-1,(A0)
	BNE SUITE
	LEA	ANIMATION,A0
	MOVE.W #0,XMAN
SUITE	MOVE.L (A0),A1
	CMP.L	#BUL1,A1
	BEQ	AFFBUL
	CMP.L	#BUL2,A1
	BEQ	AFFBUL
	CMP.L	#EFFBUL,A1
	BNE	SUITE2
	ADD.W #1,MMAN
	BRA	AFFBUL
SUITE2	MOVE.L OLDSPR,A1
	MOVE.L	OLDSCREEN,A2
	MOVE.W	OLDX,D0
	MOVE.W OLDY,D1
	BSR	EFFMAN
	
	MOVE.L (A0)+,A1	;A1 = DATA SOURCE
	MOVE.L A1,OLDSPR
	MOVE.L SCREEN,A2	;A2 = DEST
	CMP.W	#36,XMAN
	BEQ	CON2
	ADD.W  #1,ATT2
	CMP.W 	#3,ATT2
	BNE	CON2
	MOVE.W #0,ATT2
	ADD.W	#1,XMAN
CON2	MOVE.W	XMAN,D0
	MOVE.W	YMAN,D1
	MOVE.W D0,OLDX
	MOVE.W D1,OLDY
	BSR	AFFSPRITE
	MOVE.L A0,TEUR
	BRA prog
AFFBUL 
FS1	MOVE.L (A0)+,A1
FS2	MOVE.L A0,TEUR
	MOVE.L SCREEN,A2
	MOVE.W	#45,D0
	MOVE.W	#109,D1
	BSR	AFFSPRITE
	BRA prog

TIR	LEA	EFMAN,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	EFFMAN
	BSR	TANTPIS
	CMP.W	#0,TIRMAN
	BNE	prog
	CMP.W	#$62,X1S
	BNE	TIR3
	CMP.W	#$34,Y1S
	BNE	TIR3
	CMP.W	#0,SPR1
	BNE	TIR3
	MOVE.W	#4,SPR1
	MOVE.W #1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog

TIR3	CMP.W	#$50,X3
	BNE	TIR4
	CMP.W	#$3A,Y3
	BNE	TIR4
	CMP.W	#0,SPR3
	BNE	TIR4
	MOVE.W	#4,SPR3
	MOVE.W	#1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog
TIR4	CMP.W	#$5A,X4
	BNE	TIR6
	CMP.W	#$A,Y4
	BNE	TIR6
	CMP.W	#0,SPR4
	BNE	TIR6
	MOVE.W	#4,SPR4
	MOVE.W	#1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog
TIR6	CMP.W	#$52,X6
	BNE	TIR7
	CMP.W	#$3e,Y6
	BNE	TIR7
	CMP.W	#0,SPR6
	BNE	TIR7
	MOVE.W	#4,SPR6
	MOVE.W	#1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog
TIR7	CMP.W	#$62,X7
	BNE	TIR5
	CMP.W	#$34,Y7
	BNE	TIR5
	CMP.W	#0,SPR7
	BNE	TIR5
	MOVE.W	#4,SPR7
	MOVE.W	#1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog
TIR5	CMP.W	#$52,X5
	BNE	TIR8
	CMP.W	#$3A,Y5
	BNE	TIR8
	CMP.W	#0,SPR5
	BNE	TIR8
	MOVE.W	#4,SPR5
	MOVE.W	#1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog
TIR8	CMP.W	#$52,X8
	BNE	TIR2
	CMP.W	#$3A,Y8
	BNE	TIR2
	CMP.W	#0,SPR8
	BNE	TIR2
	MOVE.W	#4,SPR8
	MOVE.W	#1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog
TIR2	CMP.W	#$52,X2
	BNE	FINDEMO
	CMP.W	#$3A,Y2
	BNE	FINDEMO
	CMP.W	#0,SPR2
	BNE	FINDEMO
	MOVE.W	#4,SPR2
	MOVE.W	#1,TIRMAN
	LEA	M7,A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	BRA	prog

TANTPIS 
	CMP.W	#1,TIRMAN
	BNE	SS1
	LEA	M7,A1
	BRA	SS2
SS1	LEA	M6,A1
SS2	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	RTS

FINDEMO	CMP.W	#-1,SPR1
	BNE	prog
	CMP.W	#-1,SPR2
	BNE	prog
	CMP.W	#-1,SPR3
	BNE	prog
	CMP.W	#-1,SPR4
	BNE	prog
	CMP.W	#-1,SPR5
	BNE	prog
	CMP.W	#-1,SPR6
	BNE	prog
	CMP.W	#-1,SPR7
	BNE	prog
	CMP.W	#-1,SPR8
	BNE	prog
	MOVE.L	#FINDEMOVBL,$4D2
	move.w	#0,$FF8900
	MOVE.L	#0,$4D6
	MOVE.W #0,ATTENTE
	MOVE.W #0,ATT2
	RTS
FINDEMOVBL	
	ADDQ.W #1,ATTENTE
	CMP.W	#48+24,ATTENTE
	BNE	NOMORE
	MOVE.W	#47+24,ATTENTE
	
	MOVEQ #0,D0
	ADDQ.W #4,ATT2
	MOVE.W ATT2,D0
	LEA	ANIM3,A0
	ADD.L	D0,A0
	CMP.L	#-1,(A0)
	BNE	MORE
	LEA	ANIM3,A0
	MOVE.W #0,ATT2
MORE	MOVE.L (A0),A1
	MOVE.L SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	CMP.W	#320-34,XMAN
	BLE	FDS
	MOVE.W	#0,D0
	MOVE.W	YMAN,D1
	MOVE.L	SCREEN,A2
	LEA	EFMAN,A1
	BSR	AFFSPRITE
FDS	ADDQ.W	#2,XMAN
	CMP.W	#320,XMAN
	BNE	FIN1
	MOVE.L	#DEMOVBL2,$4D2
	MOVE.W	#0,ATTENTE
	MOVE.W #0,ATT2
FIN1	RTS
DEMOVBL2
	ADDQ.W #1,ATTENTE
	CMP.W	#50,ATTENTE
	BNE	NOMORE2
	MOVE.W	#49,ATTENTE
	
	CMP.W 	#0,ATT2
	BEQ	ZZ1
	CMP.W	#1,ATT2
	BEQ	ZZ2
	CMP.W	#2,ATT2
	BEQ	ZZ3
	CMP.W	#3,ATT2
	BEQ	ZZ4

ZZ1	LEA	M10,A1
	SUB.W #1,XMAN
	CMP.W	#320-32,XMAN
	BEQ	ZA1
	MOVE.L	SCREEN,A2
	MOVE.W	XMAN,D0
	MOVE.W	YMAN,D1
	BSR	AFFSPRITE
	MOVE.W	#0,D0
	MOVE.W	YMAN,D1
	MOVE.L	SCREEN,A2
	LEA	EFMAN,A1
	BSR	AFFSPRITE
	RTS
ZA1	MOVE.W	#1,ATT2
	RTS
ZZ2	LEA	BUL3,A1
	MOVE.L	SCREEN,A2
	MOVE.W	XMAN,D0
	SUB.W	#115,D0
	MOVE.W	YMAN,D1
	SUB.W	#42,D1
	BSR	AFFSPRITE
	MOVE.W	#2,ATT2
	RTS
ZZ3	LEA	ANIM4,A0
	ADD.L	ANI,A0
	CMP.L	#-1,(A0)
	BEQ	ZA3
	MOVE.L (A0),A1
	MOVE.L	SCREEN,A2
	MOVE.W XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	ADD.L	#4,ANI
	RTS
ZA3	MOVE.W #3,ATT2
	RTS
ZZ4	LEA	EFFBUL,A1
	MOVE.L	SCREEN,A2
	MOVE.W	#320-32-115,D0
	MOVE.W	#153-42,D1
	BSR	AFFSPRITE
	LEA	EFMAN,A1
	MOVE.L	SCREEN,A2
	MOVE.W	XMAN,D0
	MOVE.W	YMAN,D1
	BSR	AFFSPRITE
	ADD.W #1,XMAN
	CMP.W	#320,XMAN
	BEQ	ZA4
	LEA	M10,A1
	MOVE.L	SCREEN,A2
	MOVE.W	XMAN,D0
	MOVE.W	YMAN,D1
	BSR	AFFSPRITE
	MOVE.W	#0,D0
	MOVE.W	YMAN,D1
	MOVE.L	SCREEN,A2
	LEA	EFMAN,A1
	BSR	AFFSPRITE
	RTS	
ZA4	MOVE.W #-1,FINI
NOMORE2	RTS

NOMORE	MOVEQ #0,D0
	MOVE.W	ATTENTE,D0
	MULU #4,D0
	LEA	ANIM2,A0
	ADD.L D0,A0
	MOVE.L (A0),A1
	MOVE.L SCREEN,A2
	MOVE.W	XMAN,D0
	MOVE.W YMAN,D1
	BSR	AFFSPRITE
	RTS

FINI	DC.W 0
TEUR	DC.L ANIMATION
ATTENTE	DC.W 0
ATT2	DC.W 0
ANI	DC.L 0
XMAN	DC.W 0
YMAN	DC.W 153
SCREEN	DC.L $78000
OLDSCREEN	DC.L $70000
OLDSPR	DC.L M1
OLDX	DC.W 0
OLDY	DC.W 0
MMAN	DC.W 0
TIRMAN	DC.W 0

AFFSPRITE
	MOVE.W	D0,XD
	MOVE.W	D1,YD
	MOVE.L	A2,DEST
	MOVE.L (A1)+,SOURCE
				*	XS,YS,X,Y,LS,PLAN,FONC
	MOVE.W (A1)+,XS
	MOVE.W (A1)+,YS
	MOVE.W (A1)+,X
	MOVE.W (A1)+,Y
	MOVE.W (A1)+,LS
	MOVE.W (A1)+,PLAN
	MOVE.W (A1)+,FONC
	BSR	blit_it
	RTS
EFFMAN	MOVE.W	D0,XD
	MOVE.W	D1,YD
	MOVE.L	A2,DEST
	MOVE.L (A1)+,SOURCE
	MOVE.L	#FOND,SOURCE
				*	JUSTE BESOIN DE X,Y,LS,PLAN
	MOVE.W (A1)+,X
	MOVE.W (A1)+,X
	MOVE.W (A1)+,X
	MOVE.W (A1)+,Y
	MOVE.W (A1)+,LS
	MOVE.W #4,PLAN
	MOVE.w #0,FONC
	BSR	blit_it
	RTS


prog 	
	CMP.W	#8,SPR8
	BGT	NOEFF8
	MOVE.W	Y8S,D1
	MOVE.W	X8S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF8	CMP.W	#8,SPR7
	BGT	NOEFF7
	MOVE.W	Y7S,D1
	MOVE.W	X7S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF7	CMP.W	#8,SPR6
	BGT	NOEFF6
	MOVE.W	Y6S,D1
	MOVE.W	X6S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF6	CMP.W	#8,SPR5
	BGT	NOEFF5
	MOVE.W	Y5S,D1
	MOVE.W	X5S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF5	CMP.W	#8,SPR4
	BGT	NOEFF4
	MOVE.W	Y4S,D1
	MOVE.W	X4S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF4	CMP.W	#8,SPR3
	BGT	NOEFF3
	MOVE.W	Y3S,D1
	MOVE.W	X3S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF3	CMP.W	#8,SPR2
	BGT	NOEFF2		
	MOVE.W	Y2S,D1
	MOVE.W	X2S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF2	CMP.W	#8,SPR1
	BGT	NOEFF1
	MOVE.W	Y1S,D1
	MOVE.W	X1S,D0		
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	EFFMAN
NOEFF1	CMP.W #0,SPR1
	BEQ	DD1
	BSR	SHOOT1
DD1	CMP.W	#0,SPR2
	BEQ	DD2
	BSR	SHOOT2
DD2	CMP.W	#0,SPR3
	BEQ	DD3
	BSR	SHOOT3
DD3	CMP.W	#0,SPR4
	BEQ	DD4
	BSR	SHOOT4
DD4	CMP.W	#0,SPR5
	BEQ	DD5
	BSR	SHOOT5
DD5	CMP.W	#0,SPR6
	BEQ	DD6
	BSR	SHOOT6
DD6	CMP.W	#0,SPR7
	BEQ	DD7
	BSR	SHOOT7
DD7	CMP.W	#0,SPR8
	BEQ	DD8
	BSR	SHOOT8
                     
DD8	BSR	MODSPRITE
	BSR	XY
	CMP.W	#0,SPR8
	BNE	FINSPR7
	MOVE.W	X8,D0
	MOVE.W	Y8,D1
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR7	CMP.W	#0,SPR7
	BNE	FINSPR6
	MOVE.W	X7,D0
	MOVE.W	Y7,D1
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR6	CMP.W	#0,SPR6
	BNE	FINSPR5
	MOVE.W	X6,D0
	MOVE.W	Y6,D1
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR5	CMP.W	#0,SPR5
	BNE	FINSPR4
	MOVE.W	X5,D0
	MOVE.W	Y5,D1
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR4	CMP.W	#0,SPR4
	BNE	FINSPR3
	MOVE.W	X4,D0
	MOVE.W	Y4,D1
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR3	CMP.W	#0,SPR3
	BNE	FINSPR2	
	MOVE.W	X3,D0
	MOVE.W	Y3,D1
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR2	CMP.W	#0,SPR2
	BNE	FINSPR1
	MOVE.W	X2,D0
	MOVE.W	Y2,D1
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR1	CMP.W #0,SPR1
	BNE	FINSPR
	MOVE.W	X1,D0
	MOVE.W	Y1,D1	
	LEA	BAL1,A1
	MOVE.L	OLDSCREEN,A2
	BSR	AFFSPRITE
FINSPR	RTS
	
WW DC.W 0
SHOOT1	CMP.W #-1,SPR1
	BEQ	FINBAL11
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR1,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB12	ADD.W	#4,SPR1
	LEA	SPRITE1,A1
	MOVE.W	SPR1,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB11
	MOVE.W #2,TIRMAN
BBB11	
	LEA	BOING,A0
	MOVE.W	SPR1,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB13
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB12
BBB13	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL12	
	RTS
FINBAL11	MOVE.W #-1,SPR1
	RTS
FINBAL12	
	MOVE.W #0,TIRMAN
	LEA	BOING,A0
	MOVE.W	SPR1,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR1
	RTS
SHOOT2	CMP.W #-1,SPR2
	BEQ	FINBAL21
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR2,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB22	ADD.W	#4,SPR2
	LEA	SPRITE1,A1
	MOVE.W	SPR2,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB21
	MOVE.W #2,TIRMAN
BBB21
	LEA	BOING,A0
	MOVE.W	SPR2,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB23
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB22
BBB23	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL22	
	RTS
FINBAL21	MOVE.W #-1,SPR2
	RTS
FINBAL22	MOVE.W #0,TIRMAN
	LEA	BOING,A0
	MOVE.W	SPR2,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR2
	RTS
SHOOT3	CMP.W #-1,SPR3
	BEQ	FINBAL31
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR3,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB32	ADD.W	#4,SPR3
	LEA	SPRITE1,A1
	MOVE.W	SPR3,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB31
	MOVE.W #2,TIRMAN
BBB31	
	LEA	BOING,A0
	MOVE.W	SPR3,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB33
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB32
BBB33	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL32	
	RTS
FINBAL31	MOVE.W #-1,SPR3
	RTS
FINBAL32	
	MOVE.W #0,TIRMAN
	LEA	BOING,A0
	MOVE.W	SPR3,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR3
	RTS
SHOOT4	CMP.W #-1,SPR4
	BEQ	FINBAL41
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR4,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB42	ADD.W	#4,SPR4
	LEA	SPRITE1,A1
	MOVE.W	SPR4,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB41
	MOVE.W #2,TIRMAN
BBB41	
	LEA	BOING,A0
	MOVE.W	SPR4,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB43
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB42
BBB43	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL42	
	RTS
FINBAL41	MOVE.W #-1,SPR4
	RTS
FINBAL42	
	MOVE.W #0,TIRMAN
	LEA	BOING,A0
	MOVE.W	SPR4,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR4
	RTS
SHOOT5	CMP.W #-1,SPR5
	BEQ	FINBAL51
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR5,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB52	ADD.W	#4,SPR5
	LEA	SPRITE1,A1
	MOVE.W	SPR5,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB51
	MOVE.W #2,TIRMAN
BBB51	
	LEA	BOING,A0
	MOVE.W	SPR5,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB53
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB52
BBB53	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL52	
	RTS
FINBAL51	MOVE.W #-1,SPR5
	RTS
FINBAL52	
	MOVE.W #0,TIRMAN   
	LEA	BOING,A0
	MOVE.W	SPR5,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR5
	RTS
SHOOT6	CMP.W #-1,SPR6
	BEQ	FINBAL61
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR6,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB62	ADD.W	#4,SPR6
	LEA	SPRITE1,A1
	MOVE.W	SPR6,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB61
	MOVE.W #2,TIRMAN
BBB61
	LEA	BOING,A0
	MOVE.W	SPR6,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB63
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB62
BBB63	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL62	
	RTS
FINBAL61	MOVE.W #-1,SPR6
	RTS
FINBAL62	
	MOVE.W #0,TIRMAN
	LEA	BOING,A0
	MOVE.W	SPR6,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR6
	RTS
SHOOT7	CMP.W #-1,SPR7
	BEQ	FINBAL71
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR7,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB72	ADD.W	#4,SPR7
	LEA	SPRITE1,A1
	MOVE.W	SPR7,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB71
	MOVE.W #2,TIRMAN
BBB71
	LEA	BOING,A0
	MOVE.W	SPR7,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB73
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB72
BBB73	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL72	
	RTS
FINBAL71	MOVE.W #-1,SPR7
	RTS
FINBAL72	
	MOVE.W #0,TIRMAN
	LEA	BOING,A0
	MOVE.W	SPR7,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR7
	RTS
SHOOT8	CMP.W #-1,SPR8
	BEQ	FINBAL81
	MOVEQ #0,D0
	LEA	BAL6,A1
	MOVE.L OLDSCREEN,A2
	MOVE.W	SPR8,D0
	SUB.W	#4,D0
	LEA	BOING,A0
	ADD.L	D0,A0
	MOVE.W (A0)+,D0
	MOVE.W (A0)+,D1
	BSR	EFFMAN
BBB82	ADD.W	#4,SPR8
	LEA	SPRITE1,A1
	MOVE.W	SPR8,D0
	ADD.L	D0,A1
	CMP.L #BAL6,(A1)
	BNE	BBB81
	MOVE.W #2,TIRMAN
BBB81
	LEA	BOING,A0
	MOVE.W	SPR8,D0
	ADD.L	D0,A0
	CMP.L	#$00F400A9,(A0)
	BEQ	BBB83
	LEA 	-4(A0),A3
	CMP.L	(A0),A3
	BEQ	BBB82
BBB83	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	MOVE.L (A1),A1
	MOVE.L	OLDSCREEN,A2
	BSR AFFSPRITE
	CMP.W	#-1,(A0)
	BEQ	FINBAL82	
	RTS
FINBAL81	MOVE.W #-1,SPR8
	RTS
FINBAL82	
	MOVE.W #0,TIRMAN
	LEA	BOING,A0
	MOVE.W	SPR8,D0
	SUB.W	#4,D0
	ADD.L	D0,A0
	MOVE.W	(A0)+,D0
	MOVE.W	(A0)+,D1
	LEA	BAL6,A1
	MOVE.L	OLDSCREEN,A2
	BSR EFFMAN
	MOVE.L	SCREEN,A2
	LEA	BAL6,A1
	BSR EFFMAN
	MOVE.W #-1,SPR8
	RTS

MODSPRITE
	MOVE.W	X8,X8S
	MOVE.W	Y8,Y8S
	MOVE.W	X7,X7S
	MOVE.W	Y7,Y7S
	MOVE.W	X6,X6S
	MOVE.W	Y6,Y6S
	MOVE.W	X5,X5S
	MOVE.W	Y5,Y5S
	MOVE.W	X4,X4S
	MOVE.W	Y4,Y4S
	MOVE.W	X3,X3S
	MOVE.W	Y3,Y3S
	MOVE.W	X2,X2S
	MOVE.W	Y2,Y2S
	MOVE.W	X1,X1S
	MOVE.W	Y1,Y1S
	LEA	XX7,A0
	MOVE.W 18(A0),X8
	MOVE.W 16(A0),18(A0)
	MOVE.W 14(A0),16(A0)
	MOVE.W 12(A0),14(A0)
	MOVE.W 10(A0),12(A0)
	MOVE.W 8(A0),10(A0)
	MOVE.W 6(A0),8(A0)
	MOVE.W 4(A0),6(A0)
	MOVE.W 2(A0),4(A0)
	MOVE.W (A0),2(A0)
	LEA	YY7,A1
	MOVE.W 18(A1),Y8
	MOVE.W 16(A1),18(A1)
	MOVE.W 14(A1),16(A1)
	MOVE.W 12(A1),14(A1)
	MOVE.W 10(A1),12(A1)
	MOVE.W 8(A1),10(A1)
	MOVE.W 6(A1),8(A1)
	MOVE.W 4(A1),6(A1)
	MOVE.W 2(A1),4(A1)
	MOVE.W (A1),2(A1)
	MOVE.W	X7,(A0)
	MOVE.W	Y7,(A1)
	LEA	XX6,A0
	MOVE.W 18(A0),X7
	MOVE.W 16(A0),18(A0)
	MOVE.W 14(A0),16(A0)
	MOVE.W 12(A0),14(A0)
	MOVE.W 10(A0),12(A0)
	MOVE.W 8(A0),10(A0)
	MOVE.W 6(A0),8(A0)
	MOVE.W 4(A0),6(A0)
	MOVE.W 2(A0),4(A0)
	MOVE.W (A0),2(A0)
	LEA	YY6,A1
	MOVE.W 18(A1),Y7
	MOVE.W 16(A1),18(A1)
	MOVE.W 14(A1),16(A1)
	MOVE.W 12(A1),14(A1)
	MOVE.W 10(A1),12(A1)
	MOVE.W 8(A1),10(A1)
	MOVE.W 6(A1),8(A1)
	MOVE.W 4(A1),6(A1)
	MOVE.W 2(A1),4(A1)
	MOVE.W (A1),2(A1)
	MOVE.W	X6,(A0)
	MOVE.W	Y6,(A1)
	LEA	XX5,A0
	MOVE.W 18(A0),X6
	MOVE.W 16(A0),18(A0)
	MOVE.W 14(A0),16(A0)
	MOVE.W 12(A0),14(A0)
	MOVE.W 10(A0),12(A0)
	MOVE.W 8(A0),10(A0)
	MOVE.W 6(A0),8(A0)
	MOVE.W 4(A0),6(A0)
	MOVE.W 2(A0),4(A0)
	MOVE.W (A0),2(A0)
	LEA	YY5,A1
	MOVE.W 18(A1),Y6
	MOVE.W 16(A1),18(A1)
	MOVE.W 14(A1),16(A1)
	MOVE.W 12(A1),14(A1)
	MOVE.W 10(A1),12(A1)
	MOVE.W 8(A1),10(A1)
	MOVE.W 6(A1),8(A1)
	MOVE.W 4(A1),6(A1)
	MOVE.W 2(A1),4(A1)
	MOVE.W (A1),2(A1)
	MOVE.W	X5,(A0)
	MOVE.W	Y5,(A1)
	LEA	XX4,A0
	MOVE.W 18(A0),X5
	MOVE.W 16(A0),18(A0)
	MOVE.W 14(A0),16(A0)
	MOVE.W 12(A0),14(A0)
	MOVE.W 10(A0),12(A0)
	MOVE.W 8(A0),10(A0)
	MOVE.W 6(A0),8(A0)
	MOVE.W 4(A0),6(A0)
	MOVE.W 2(A0),4(A0)
	MOVE.W (A0),2(A0)
	LEA	YY4,A1
	MOVE.W 18(A1),Y5
	MOVE.W 16(A1),18(A1)
	MOVE.W 14(A1),16(A1)
	MOVE.W 12(A1),14(A1)
	MOVE.W 10(A1),12(A1)
	MOVE.W 8(A1),10(A1)
	MOVE.W 6(A1),8(A1)
	MOVE.W 4(A1),6(A1)
	MOVE.W 2(A1),4(A1)
	MOVE.W (A1),2(A1)
	MOVE.W	X4,(A0)
	MOVE.W	Y4,(A1)
	LEA	XX3,A0
	MOVE.W 18(A0),X4
	MOVE.W 16(A0),18(A0)
	MOVE.W 14(A0),16(A0)
	MOVE.W 12(A0),14(A0)
	MOVE.W 10(A0),12(A0)
	MOVE.W 8(A0),10(A0)
	MOVE.W 6(A0),8(A0)
	MOVE.W 4(A0),6(A0)
	MOVE.W 2(A0),4(A0)
	MOVE.W (A0),2(A0)
	LEA	YY3,A1
	MOVE.W 18(A1),Y4
	MOVE.W 16(A1),18(A1)
	MOVE.W 14(A1),16(A1)
	MOVE.W 12(A1),14(A1)
	MOVE.W 10(A1),12(A1)
	MOVE.W 8(A1),10(A1)
	MOVE.W 6(A1),8(A1)
	MOVE.W 4(A1),6(A1)
	MOVE.W 2(A1),4(A1)
	MOVE.W (A1),2(A1)
	MOVE.W	X3,(A0)
	MOVE.W	Y3,(A1)
	LEA	XX2,A0
	MOVE.W 18(A0),X3
	MOVE.W 16(A0),18(A0)
	MOVE.W 14(A0),16(A0)
	MOVE.W 12(A0),14(A0)
	MOVE.W 10(A0),12(A0)
	MOVE.W 8(A0),10(A0)
	MOVE.W 6(A0),8(A0)
	MOVE.W 4(A0),6(A0)
	MOVE.W 2(A0),4(A0)
	MOVE.W (A0),2(A0)
	LEA	YY2,A1
	MOVE.W 18(A1),Y3
	MOVE.W 16(A1),18(A1)
	MOVE.W 14(A1),16(A1)
	MOVE.W 12(A1),14(A1)
	MOVE.W 10(A1),12(A1)
	MOVE.W 8(A1),10(A1)
	MOVE.W 6(A1),8(A1)
	MOVE.W 4(A1),6(A1)
	MOVE.W 2(A1),4(A1)
	MOVE.W (A1),2(A1)
	MOVE.W	X2,(A0)
	MOVE.W	Y2,(A1)
	LEA	XX1,A0
	MOVE.W 18(A0),X2
	MOVE.W 16(A0),18(A0)
	MOVE.W 14(A0),16(A0)
	MOVE.W 12(A0),14(A0)
	MOVE.W 10(A0),12(A0)
	MOVE.W 8(A0),10(A0)
	MOVE.W 6(A0),8(A0)
	MOVE.W 4(A0),6(A0)
	MOVE.W 2(A0),4(A0)
	MOVE.W (A0),2(A0)
	LEA	YY1,A1
	MOVE.W 18(A1),Y2
	MOVE.W 16(A1),18(A1)
	MOVE.W 14(A1),16(A1)
	MOVE.W 12(A1),14(A1)
	MOVE.W 10(A1),12(A1)
	MOVE.W 8(A1),10(A1)
	MOVE.W 6(A1),8(A1)
	MOVE.W 4(A1),6(A1)
	MOVE.W 2(A1),4(A1)
	MOVE.W (A1),2(A1)
	MOVE.W	X1,(A0)
	MOVE.W	Y1,(A1)
	RTS


XY	MOVE.L POINT,A0
	CMP.W #-1,(A0)
	BNE	XYXY
	LEA	BUFFER,A0
XYXY	MOVE.W (A0)+,X1
	MOVE.W (A0)+,Y1
	MOVE.L A0,POINT
	RTS
MOUSE	LEA	$EA0,A0		;lecture coords
	CLR.W	D0
	CLR.W	D1
	CLR.W	D2
	MOVE.B	(A0),D0
	MOVE.B	1(A0),D1
	MOVE.B	2(A0),D2	
	CLR.B	1(A0)
	CLR.B	2(A0)
	SUB.W	#$F8,D0
	EXT	D1
	EXT	D2
	MOVE.W	D0,KM
	LSL	#1,D1
	LSL	#1,D2
	ADD.W	D1,X1
	ADD.W	D2,Y1
	RTS
TESTBORDS	MOVE.W	X1,D0
	CMP.W	#0,D0
	BGT	HORIZON
	CLR.W	D0
	BRA	SCRIN
HORIZON	CMP.W	#319-32,D0
	BLT	SCRIN
	MOVE.W	#319-31,D0
SCRIN	MOVE.W	D0,X1
	MOVE.W	Y1,D0
	CMP.W	#0,D0
	BGT	VERTIC
	CLR.W	D0
	BRA	SCRIN2
VERTIC	CMP.W	#200-32,D0
	BLT	SCRIN2
	MOVE.W	#200-31,D0
SCRIN2	MOVE.W	D0,Y1
	RTS
KM	DC.W 0
BLITTER        equ       $FF8A00
demiteinte     equ       0         
Src_Xinc       equ       32        
Src_Yinc       equ       34        
Src_Addr       equ       36        
Endmask1       equ       40        
Endmask2       equ       42        
Endmask3       equ       44        
Dst_Xinc       equ       46        
Dst_Yinc       equ       48        
Dst_Addr       equ       50        
largeur        equ       54        
hauteur        equ       56        
HOP            equ       58        
OP             equ       59        
Line_Num       equ       60        
Oblique        equ       61        
fHOP_Source   	equ       1
fHOP_demiteinte  	equ       0
fObliqueFXSR      	equ       7
fObliqueNFSR      	equ       6
fLineBusy      	equ       7
fLineHog       	equ       6
fLineSmudge    	equ       5
mHOP_Source    	equ       $02
mHOP_demiteinte  	equ       $01
mObliqueFXSR      	equ       $80
mObliqueNFSR      	equ       $40
mLineBusy      	equ       $80
mLineHog       	equ       $40
mLineSmudge    	equ       $20
lf_endmask
     dc.w      $FFFF
rt_endmask
     dc.w      $7FFF,$3FFF,$1FFF,$0FFF,$07FF,$03FF,$01FF			
     dc.w      $00FF,$007F,$003F,$001F,$000F,$0007,$0003,$0001,0			
blit_it:
	movem.l a0-a6/d0-d7,-(a7)
     lea       BLITTER,a5       
     lea	 PARA,a4
     move.w    WIDTH(a4),d6
     subq.w    #1,d6            
     move.w    SRC_XMIN(a4),d0  
     move.w    d0,d1            
     add.w     d6,d1            
     move.w    DST_XMIN(a4),d2  
     move.w    d2,d3            
     add.w     d6,d3            
     moveq     #$0F,d6          
     move.w    d2,d4            
     and.w     d6,d4            
     add.w     d4,d4            
     move.w    lf_endmask(pc,d4.w),d4
     move.w    d3,d5            
     and.w     d6,d5            
     add.w     d5,d5            
     move.w    rt_endmask(pc,d5.w),d5
     not.w     d5               
     move.w    d2,d7            
     and.w     d6,d7            
     and.w     d0,d6            
     sub.w     d6,d7            
     clr.w     d6               
     addx.w    d6,d6            
     lsr.w     #4,d0            
     lsr.w     #4,d1            
     sub.w     d0,d1            
     lsr.w     #4,d2            
     lsr.w     #4,d3            
     sub.w     d2,d3            
     bne       set_endmasks     
     and.w     d5,d4            
     addq.w    #4,d6            
set_endmasks:
     move.w    d4,Endmask1(a5)  
     move.w    #$FFFF,Endmask2(a5)
     move.w    d5,Endmask3(a5)  
     cmp.w     d1,d3            
     bne       set_count        
     addq.w    #2,d6            
set_count:
     move.w    d3,d4
     addq.w    #1,d4            
     move.w    d4,largeur(a5)   
     move.l    SRC_BASE(a4),a0  
     move.w    SRC_YMIN(a4),d4  
     move.w    SRC_NXLN(a4),d5  
     mulu      d5,d4            
     add.l     d4,a0            
     move.w    SRC_NXWD(a4),d4  
     move.w    d4,Src_Xinc(a5)  
     mulu      d4,d0            
     add.l     d0,a0            
     mulu      d4,d1            
     sub.w     d1,d5            
     move.w    d5,Src_Yinc(a5)  
     move.l    DST_BASE(a4),a1  
     move.w    DST_YMIN(a4),d4  
     move.w    DST_NXLN(a4),d5  
     mulu      d5,d4            
     add.l     d4,a1            
     move.w    DST_NXWD(a4),d4  
     move.w    d4,Dst_Xinc(a5)  
     mulu      d4,d2            
     add.l     d2,a1            
     mulu      d4,d3            
     sub.w     d3,d5            
     move.w    d5,Dst_Yinc(a5)  
     and.b     #$0F,d7          	       
     or.b      Oblique_flags(pc,d6.w),d7  
     move.b    d7,Oblique(a5)      	
     move.b    #mHOP_Source,HOP(a5)	
     move.W	 FONC,d6
     move.b    d6,OP(a5)        		
     lea       Line_Num(a5),a2  		
     move.b    #6,d2    		;partage ou occupation du bus
     move.w    PLANES(a4),d7    		
     bra       begin
Oblique_flags:
     dc.b      mObliqueNFSR        
     dc.b      mObliqueFXSR        
     dc.b      0                   
     dc.b      mObliqueNFSR+mObliqueFXSR 
     dc.b      0                
     dc.b      mObliqueFXSR     
     dc.b      0                
     dc.b      0                
next_plane:
     move.l    a0,Src_Addr(a5)  		
     move.l    a1,Dst_Addr(a5)  		
     move.w    HEIGHT(a4),hauteur(a5)	
     move.b    #mLineBusy,(a2)  		
     add.w     SRC_NXPL(a4),a0  		
     add.w     DST_NXPL(a4),a1  		
restart:
     bset.b    d2,(a2)          
     nop                        
     bne       restart          
begin:
     dbra      d7,next_plane    
	movem.l (a7)+,a0-a6/d0-d7
     rts
ecran	dc.l 0
SRC_BASE       equ       0
SRC_NXWD       equ       4
SRC_NXLN       equ       6
SRC_NXPL       equ       8
SRC_XMIN       equ      10
SRC_YMIN       equ      12
DST_BASE       equ      14
DST_NXWD       equ      18
DST_NXLN       equ      20
DST_NXPL       equ      22
DST_XMIN       equ      24
DST_YMIN       equ      26
WIDTH          equ      28
HEIGHT         equ      30
PLANES         equ      32
PARA	
SOURCE	dc.l	FOND
	dc.w	8
LS	dc.w   16
	dc.w   2
XS	dc.w  	0
YS	dc.w	100

DEST	dc.l	$F8000
	dc.w	8
LD	dc.w	160
	dc.w	2
XD	dc.w	0
YD	dc.w	0

X	dc.w	32
Y	dc.w	29
PLAN	dc.w	3
FONC	dc.W	3
	even
ANIMATION	
	DC.L   M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2,M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2
	DC.L   M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2,M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2
	DC.L   M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2,M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2
	DC.L   M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2,M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2
	DC.L   M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2
	DC.L	BUL1,BUL1,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4,M3,M3,M3,M3,M3,M3,M4,M4,M4,M4,M4,M4
	DC.L	BUL2,BUL2,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	EFFBUL,EFFBUL
	DC.L -1
ANIM2
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	DC.L	M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9,M8,M8,M8,M8,M8,M8,M9,M9,M9,M9,M9,M9
	
ANIM3
	DC.L   M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2,M1,M1,M1,M1,M1,M1,M2,M2,M2,M2,M2,M2
	DC.L	-1
ANIM4	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11,M10,M10,M10,M10,M10,M10,M11,M11,M11,M11,M11,M11
	DC.L	-1
	
SPRITE1
	DC.L	BAL1,BAL1,BAL1,BAL1,BAL2,BAL2,BAL2,BAL2,BAL3,BAL3,BAL3,BAL3,BAL4,BAL4,BAL4,BAL4,BAL5,BAL5,BAL5,BAL5
	REPT $5E-34+40
	DC.L	BAL6
	ENDR
	DC.L	BAL1,BAL1,BAL1,BAL2,BAL2,BAL2,BAL3,BAL3,BAL3,BAL4,BAL4,BAL4,BAL5,BAL5,BAL5
	DC.L -1

	
	
	*	NOM DU DESSIN SOURCE
	*	XS , YS = POSITION DANS DESSIN SOURCE
	*	X  , Y  = TAILLE DU BOB
	*	LS      = (LARGEUR DU DESSIN SOURCE)/2
	*	PLAN	 = NBR DE PLANS A TRANSFERER
	*	FONC	 : 3=REPLACE , 6=OR , 7=EOR
	*	XS,YS,X,Y,LS,PLAN,FONC

M1	DC.L	MAN
	DC.W	0,0,32,$30,$90,4,3
M2	DC.L	MAN
	DC.W  	32,0,32,$30,$90,4,3
M3	DC.L	MAN
	DC.W	64,0,29,$30,$90,4,3
M4	DC.L	MAN
	DC.W	96,0,29,$30,$90,4,3
M5	DC.L	MAN
	DC.W	128,0,29,$30,$90,4,3
M6	DC.L	MAN
	DC.W	160,0,29,$30,$90,4,3
M7	DC.L	MAN
	DC.W	192,0,29,$30,$90,4,3
M8	DC.L	MAN
	DC.W	224,0,32,$30,$90,4,3
M9	DC.L	MAN
	DC.W	256,0,32,$30,$90,4,3
M10	DC.L	MANMORAL
	DC.W	0,0,32,$2F,$20,4,3
M11	DC.L	MANMORAL
	DC.W	32,0,32,$2F,$20,4,3
EFMAN	DC.L   FOND
	DC.W   0,0,32,$30,14,4,3

BUL1	DC.L	BULL1
	DC.W	0,0,144,40,72,4,3
BUL2	DC.L   BULL2
	DC.W	0,0,144,40,72,4,3
BUL3	DC.L	BULL3
	DC.W	0,0,$89,$28,$48,4,3
EFFBUL	DC.L	FOND
	DC.W   0,0,144,40,72,4,3
BAL1	DC.L	BALL1
	DC.W	0,0,32,32,16,3,6
BAL2	DC.L	BALL2
	DC.W   0,0,32,32,16,3,6
BAL3	DC.L	BALL3
	DC.W   0,0,32,32,16,3,6
BAL4	DC.L	BALL4
	DC.W   0,0,32,32,16,3,6
BAL5	DC.L	BALL5
	DC.W   0,0,32,32,16,3,6
BAL6	DC.L	BALL6
	DC.W   0,0,32,32,16,4,6

BALL1	incbin	ball1.z
BALL2	incbin	ball2.z
BALL3	incbin	ball3.z
BALL4	incbin	ball4.z
BALL5	incbin	ball5.z
BALL6	incbin	ball6.z
MAN	INCBIN	MAN.Z
MANMORAL	INCBIN	MORAL.Z
BULL1	INCBIN	BULL1.Z
BULL2	INCBIN	BULL2.Z
BULL3	INCBIN	BULL3.Z



SONG
	BSR	INIT_MUZEXX
	BRA	PLAY_MUZEXX
	BRA	PLAY_MUZ

INIT_MUZEXX
	LEA		SEQ(PC),A0
	LEA		PAT(PC),A1
	LEA		NBR_INS(PC),A2
	LEA		MUZEXX,A3
	MOVE	#$1D8,(A0)
	MOVE	#$258,(A1)
	MOVE	#15,(A2)
	CMP.L	#'M.K.',$438(A3)
	BNE		REAL_DOCs_MODULE
	MOVE	#$3B8,(A0)
	MOVE	#$43C,(A1)
	MOVE	#31,(A2)
REAL_DOCs_MODULE

	LEA		MUZEXX(PC),A0
	ADD		SEQ(PC),A0
	MOVE.L	#$80,D0
	MOVEQ	#0,D1
INIT_MUZEXX1
	MOVE.L	D1,D2
	SUBQ	#1,D0
INIT_MUZEXX2
	MOVE.B	(A0)+,D1
	CMP.B	D2,D1
	BGT.S	INIT_MUZEXX1
	DBF		D0,INIT_MUZEXX2
	ADDQ.B	#1,D2
	SWAP	D2
	LSR.L	#6,D2
	LEA		MUZEXX(PC),A0
	ADD		PAT,A0
	ADD.L	D2,A0
	LEA		20+MUZEXX(PC),A1
	LEA		16+INS(PC),A2
	MOVE	NBR_INS(PC),D0
	SUBQ	#1,D0
INIT_MUZEXX3
	MOVE.L	A0,4(A2)
	MOVEQ	#0,D1
	MOVE	22(A1),D1
	LSL.L	#1,D1
	MOVE.L	D1,(A2)
	ADD.L	D1,A0
	MOVEQ	#0,D1
	MOVE	24(A1),D1
	BEQ		INIT_MUZEXX4
	SUBQ	#1,D1
INIT_MUZEXX4
	MOVE	D1,12(A2)
	MOVEQ	#0,D1
	MOVE	28(A1),D1
	LSL.L	#1,D1
	CMP.L	#2,D1
	BNE		INIT_MUZEXX5
	MOVEQ	#0,D1
INIT_MUZEXX5
	SWAP	D1
	MOVE.L	D1,8(A2)
	LEA		30(A1),A1
	LEA		16(A2),A2
	DBRA	D0,INIT_MUZEXX3

	LEA 		MU,A0
	MOVE.W		#2520,D0
CCLR	MOVE.L 	#0,(A0)+
	DBF		D0,CCLR
 	
	MOVE.W	#1,$FF8920   
	MOVE.L		MU,D0
	LEA		$FF8901,A0
	MOVEP.L	D0,(A0)
	MOVE.L 	MUS_END,D0	
	MOVEP.L	D0,12(A0)	
	MOVE.L		#$33fc0003,rt
	MOVE.L		#$00ff8900,rt+4	
	RTS

PLAY_MUZEXX
ON	
	MOVE	#6,SPD+2
	MOVE.B	#6,SPEED
	MOVE.B	#1,POS
	LEA		MUZEXX(PC),A0
	ADD		SEQ(PC),A0
	LEA		-2(A0),A0
	MOVE.B	(A0)+,TRK
	MOVE.L	A0,MUS+2
	LEA		OFF(PC),A0
	LEA		OFF(PC),A1
	LEA		OFF(PC),A2
	LEA		OFF(PC),A3
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	CLR.L	V0+2
	CLR.L	V1+2
	CLR.L	V2+2
	CLR.L	V3+2
	CLR.L	F0+2
	CLR.L	F1+2
	CLR.L	F2+2
	CLR.L	F3+2
	MOVE.W	#$7FF,$FFFF8924
	MOVE.W	#$48C,$FFFF8922
	;MOVE.W	#$44A,$FFFF8922
	RTS

MUSC		DC.L	MU,MU+504,MU+1008,MU+1512,MU+2016,MU+2520,MU+3024
		DC.L	MU+3528,MU+4032,MU+4536,MU+5040,MU+5544,MU+6046
		DC.L	MU+6550,MU+7054,MU+7558,MU+8062,MU+8566,MU+9070
		DC.L	MU+9574

AMIGA	
	MOVE.B		MUSI,D7
	ADDQ.B		#4,D7
	CMP.B		#80,D7
	BNE.S		AM3
	MOVEQ.B	#0,D7
AM3
	MOVE.B		D7,MUSI
	MOVE.L		MUSC(PC,D7.W),A4
AMM
	MOVEQ		#0,D7
	MOVE.W		#252,D6
AM2
	SWAP		D0					;2 DOUBLE CYCLES	
	SWAP		D1					;2
	SWAP		D2					;2
	SWAP		D3					;2
V0	SUB.L		#0,D0					;8
	BMI.S		L0					;4
V1	SUB.L		#0,D1					;8
	BMI.S		L1					;4
V2	SUB.L		#0,D2					;8
	BMI.S		L2					;4
V3	SUB.L		#0,D3					;8
	BMI.S		L3					;4
OUT	SWAP		D0					;2
	SWAP		D1					;2
	SWAP		D2					;2
	SWAP		D3					;2
	MOVE.B		0(A0,D0),D4				;7
	MOVE.B		0(A1,D1),D5				;7
	ADD.B		0(A2,D2),D4				;7
	ADD.B		0(A3,D3),D5				;7	
	;SUB.B		#$80,D5				;2
	;SUB.B		#$80,D4				;2
	MOVE.B		D4,(A4)+			
	MOVE.B		D5,(A4)+
	DBF D6,AM2						;5
rt	MOVE.W 	#3,$FF8900
	MOVE.W		#$4E75,rt
	RTS	
	
L0	MOVE.L		#0,D0
F0	MOVE.L		#0,V0+2
	BRA		V1
L1	MOVE.L		#0,D1
F1	MOVE.L		#0,V1+2
	BRA		V2
L2	MOVE.L		#0,D2
F2	MOVE.L		#0,V2+2
	BRA		V3
L3	MOVE.L		#0,D3
F3	MOVE.L		#0,V3+2
	BRA		OUT

PLAY_MUZ	MOVE.W #0,$FF8240
	MOVEM.L	D0-D7/A0-A6,-(A7)
	MOVEM.L	REGIS,D0-D6/A0-A6
	JSR		AMIGA
	SUBQ.B	#1,SPEED
	BEQ.S	PLAY
	JSR		EFFECT
END_VBL
	MOVEM.L	D0-D6/A0-A6,REGIS
	MOVEM.L	(A7)+,D0-D7/A0-A6
	MOVE.W #0,$FF8240
	RTS


PLAY
NO_KEYBOARD1
	MOVEM.L	D0-D1/A0-A5,-(SP)
SPD	MOVE.B	#6,SPEED
	SUBQ.B	#1,POS
	BNE		NO_NEW_PATTERN
	MOVE.B	#64,POS
	ADDQ.L	#1,MUS+2
	SUBQ.B	#1,TRK
	BMI		RESTART
	MOVEQ	#0,D0
MUS	MOVE.B	$0,D0
	SWAP	D0
	LSR.L	#6,D0
	LEA		MUZEXX(PC),A0
	ADD		PAT(PC),A0
	ADD.L	D0,A0
	MOVE.L	A0,ADD_IN_PAT
NO_NEW_PATTERN
	MOVE.L	ADD_IN_PAT(PC),A0
	LEA		FRQ(PC),A1
	LEA		INS(PC),A2
	LEA		COMMAND(PC),A3
	LEA		VOICE0(PC),A4
	BSR		LOAD_VOICE
	LEA		VOICE1(PC),A4
	BSR		LOAD_VOICE
	LEA		VOICE2(PC),A4
	BSR		LOAD_VOICE
	LEA		VOICE3(PC),A4
	BSR		LOAD_VOICE
	MOVE.L	A0,ADD_IN_PAT
	MOVEM.L	(SP)+,D0-D1/A0-A5
* ADDRESS ALL 4 VOICES
	MOVEM.L	D4/A5,-(SP)
	LEA		VOICE0(PC),A5
	TST.B	20(A5)
	BEQ.S	CONT0
	MOVE.L	(A5),D0
	MOVE.L	4(A5),A0
	MOVE.L	8(A5),D4
	MOVE.L	D4,L0+2
	MOVE.L	12(A5),D4
	MOVE.L	D4,V0+2
	MOVE.L	16(A5),D4
	MOVE.L	D4,F0+2
CONT0
	CLR.B	20(A5)
	LEA		VOICE1(PC),A5
	TST.B	20(A5)
	BEQ.S	CONT1
	MOVE.L	(A5),D1
	MOVE.L	4(A5),A1
	MOVE.L	8(A5),D4
	MOVE.L	D4,L1+2
	MOVE.L	12(A5),D4
	MOVE.L	D4,V1+2
	MOVE.L	16(A5),D4
	MOVE.L	D4,F1+2
CONT1
	CLR.B	20(A5)
	LEA		VOICE2(PC),A5
	TST.B	20(A5)
	BEQ.S	CONT2
	MOVE.L	(A5),D2
	MOVE.L	4(A5),A2
	MOVE.L	8(A5),D4
	MOVE.L	D4,L2+2
	MOVE.L	12(A5),D4
	MOVE.L	D4,V2+2
	MOVE.L	16(A5),D4
	MOVE.L	D4,F2+2
CONT2
	CLR.B	20(A5)
	LEA		VOICE3(PC),A5
	TST.B	20(A5)
	BEQ.S	CONT3
	MOVE.L	(A5),D3
	MOVE.L	4(A5),A3
	MOVE.L	8(A5),D4
	MOVE.L	D4,L3+2
	MOVE.L	12(A5),D4
	MOVE.L	D4,V3+2
	MOVE.L	16(A5),D4
	MOVE.L	D4,F3+2
CONT3
	CLR.B	20(A5)
	MOVEM.L	(SP)+,D4/A5

	BRA		END_VBL

LOAD_VOICE
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVE	D0,30(A4)
	MOVE	(A0)+,D0
	BEQ.S	COMMAND?
	BTST	#12,D0
	BEQ.S	CONT_FRQ
	AND		#$FFF,D0
	MOVE	#$100,D1
CONT_FRQ
	MOVE.B	#1,20(A4)
	MOVE	D0,24(A4)
	ADD		D0,D0
	ADD		D0,D0
	MOVE.L	(A1,D0.W),D0
	MOVE.L	D0,12(A4)
	TST.L	16(A4)
	BEQ.S	CONT_LOAD_FRQ
	MOVE.L	D0,16(A4)
CONT_LOAD_FRQ
	OR.B	(A0),D1
	AND		#$FF0,D1
	BEQ.S	COMMAND?
	MOVE.L	12(A4),16(A4)
	MOVE.L	0(A2,D1.W),(A4)
	MOVE.L	4(A2,D1.W),4(A4)
	MOVE.L	8(A2,D1.W),8(A4)
	BNE.S	REPEAT
	CLR.L	16(A4)
REPEAT
COMMAND?
	MOVE	(A0)+,D0
	MOVE.B	D0,D1
	AND		#$F00,D0
	LSR		#6,D0
	MOVE.L	(A3,D0.W),A5
	JMP		(A5)

NO_COMMAND
	RTS

ARPEGGIO
	TST.B	D1
	BEQ.S	NO_ARPEGGIO
	MOVE.B	#0,22(A4)
	MOVE.B	D1,23(A4)
	MOVE.B	#1,21(A4)		*ARPEGGIO COUNTER
	MOVE	#1,30(A4)
NO_ARPEGGIO
	RTS

PORTAMENTO_UP
	MOVE.B	#1,22(A4)
	MOVE.B	D1,23(A4)
	MOVE	#1,30(A4)
	RTS

PORTAMENTO_DOWN
	MOVE.B	#2,22(A4)
	MOVE.B	D1,23(A4)
	MOVE	#1,30(A4)
	RTS

POSITION_JUMP
	LEA		MUZEXX(PC),A5
	ADD		SEQ(PC),A5
	LEA		-1(A5),A5
	MOVE.B	#1,POS
	MOVE.L	A5,D0
	ADD.L	D1,D0
	MOVE.L	D0,MUS+2
	MOVE.B	-1(A5),D0
	SUB		D1,D0
	MOVE.B	D0,TRK
	RTS

SET_VOLUME
	TST.B	D1
	BNE.S	NO_CHANGE			*NO REAL TIME VOLUME VARIATION
	CLR.L	12(A4)				*IN THIS VERSION! MAYBE
	MOVE.B	#1,20(A4)			*SOME OTHER DAY...
NO_CHANGE
	RTS

PATTERN_BREAK
	MOVE.B	#1,POS
	RTS

SET_FILTER
	RTS

SET_SPEED
	MOVE.B	D1,SPD+3
	MOVE.B	D1,SPEED
	RTS

COMMAND		DC.L	ARPEGGIO,PORTAMENTO_UP,PORTAMENTO_DOWN,NO_COMMAND
			DC.L	NO_COMMAND,NO_COMMAND,NO_COMMAND,NO_COMMAND
			DC.L	NO_COMMAND,NO_COMMAND,NO_COMMAND,POSITION_JUMP
			DC.L	SET_VOLUME,PATTERN_BREAK,SET_FILTER,SET_SPEED

EFFECT
	MOVEM.L	D4-D6/A4-A6,-(SP)
	LEA		FRQ(PC),A5
	LEA		VOICE0(PC),A6
	TST		30(A6)
	BEQ.S	CONT_EFFECT1
	BSR		DO_EFFECT
	MOVE.L	26(A6),V0+2
	TST.L	F0+2
	BEQ.S	CONT_EFFECT1
	MOVE.L	26(A6),F0+2
CONT_EFFECT1
	LEA		VOICE1(PC),A6
	TST		30(A6)
	BEQ.S	CONT_EFFECT2
	BSR		DO_EFFECT
	MOVE.L	26(A6),V1+2
	TST.L	F1+2
	BEQ.S	CONT_EFFECT2
	MOVE.L	26(A6),F1+2
CONT_EFFECT2
	LEA		VOICE2(PC),A6
	TST		30(A6)
	BEQ.S	CONT_EFFECT3
	BSR		DO_EFFECT
	MOVE.L	26(A6),V2+2
	TST.L	F2+2
	BEQ.S	CONT_EFFECT3
	MOVE.L	26(A6),F2+2
CONT_EFFECT3
	LEA		VOICE3(PC),A6
	TST		30(A6)
	BEQ.S	CONT_EFFECT4
	BSR		DO_EFFECT
	MOVE.L	26(A6),V3+2
	TST.L	F3+2
	BEQ.S	CONT_EFFECT4
	MOVE.L	26(A6),F3+2
CONT_EFFECT4
	MOVEM.L	(SP)+,D4-D6/A4-A6
	RTS

DO_EFFECT
	MOVE.B	22(A6),D4
	BEQ.S	ARPEGGIO_ROUT
	CMP.B	#1,D4
	BEQ.S	PORTUP
	CMP.B	#2,D4
	BEQ.S	PORTDOWN
	RTS

PORTUP
	MOVEQ	#0,D4
	MOVE.B	23(A6),D4
	MOVE	24(A6),D5
	SUB		D4,D5
	CMP		#$71,D5
	BPL.S	OK_PORTUP
	MOVEQ	#$71,D5
OK_PORTUP
	MOVE	D5,24(A6)
	ADD		D5,D5
	ADD		D5,D5
	MOVE.L	(A5,D5),26(A6)
	RTS

PORTDOWN
	MOVEQ	#0,D4
	MOVE.B	23(A6),D4
	MOVE	24(A6),D5
	ADD		D4,D5
	CMP		#$358,D5
	BMI.S	OK_PORTDOWN
	MOVE	#$358,D5
OK_PORTDOWN
	MOVE	D5,24(A6)
	ADD		D5,D5
	ADD		D5,D5
	MOVE.L	(A5,D5),26(A6)
	RTS

ARPEGGIO_ROUT
	MOVE.B	21(A6),D4
	CMP.B	#1,D4
	BEQ.S	ARP_ROUT1
	CMP.B	#2,D4
	BEQ.S	ARP_ROUT2
	CMP.B	#3,D4
	BEQ.S	ARP_ROUT3
	CMP.B	#4,D4
	BEQ.S	ARP_ROUT1
	CMP.B	#5,D4
	BEQ.S	ARP_ROUT2
	RTS

ARP_ROUT1
	MOVEQ	#0,D4
	MOVE.B	23(A6),D4
	LSR.B	#4,D4
	BRA.S	ARP_ROUT
ARP_ROUT2
	MOVEQ	#0,D4
	MOVE.B	23(A6),D4
	AND.B	#$0F,D4
	BRA.S	ARP_ROUT
ARP_ROUT3
	MOVE	24(A6),D6
	BRA.S	END_ARP_ROUT2
ARP_ROUT
	ADD		D4,D4
	MOVE	24(A6),D5
	LEA		ARPEGGIO_DATA(PC),A4
ARP_LOOP
	CMP		(A4),D5
	BEQ.S	END_ARP_ROUT1
	LEA		2(A4),A4
	BRA.S	ARP_LOOP
END_ARP_ROUT1
	MOVE	(A4,D4),D6
END_ARP_ROUT2
	ADD		D6,D6
	ADD		D6,D6
	MOVE.L	(A5,D6),26(A6)
	ADDQ.B	#1,21(A6)
	RTS

RESTART
	MOVEM.L	(SP)+,D0-D1/A0-A5
	MOVE	#6,SPD+2 
	MOVE.B	#6,SPEED
	MOVE.B	#1,POS
	LEA		MUZEXX,A0
	ADD		SEQ,A0
	LEA		-2(A0),A0
	MOVE.B	(A0)+,TRK
	MOVE.L	A0,MUS+2
	LEA		OFF,A0
	LEA		OFF,A1
	LEA		OFF,A2
	LEA		OFF,A3
	MOVEQ	#0,D0
	MOVEQ	#0,D1
	MOVEQ	#0,D2
	MOVEQ	#0,D3
	CLR.L	V0+2
	CLR.L	V1+2
	CLR.L	V2+2
	CLR.L	V3+2
	CLR.L	F0+2
	CLR.L	F1+2
	CLR.L	F2+2
	CLR.L	F3+2
	BRA		PLAY

END_OF_MUZEXX
	RTS


OFF			DC.L	0
SPEED			DC.B	0
POS			DC.B	0
TRK			DC.B	0
SEQ			DS.W	1
PAT			DS.W	1
NBR_INS		DS.W	1
FRQ			incbin '12_5KHZ.FRQ',0
ARPEGGIO_DATA	DC.W	$0358,$0328,$02FA,$02D0,$02A6,$0280,$025C
				DC.W	$023A,$021A,$01FC,$01E0,$01C5,$01AC,$0194,$017D
				DC.W	$0168,$0153,$0140,$012E,$011D,$010D,$00FE,$00F0
				DC.W	$00E2,$00D6,$00CA,$00BE,$00B4,$00AA,$00A0,$0097
				DC.W	$008F,$0087,$007F,$0078,$0071,$0000,$0000,$0000

VOICE0			DS.L	8
VOICE1			DS.L	8
VOICE2			DS.L	8
VOICE3			DS.L	8
ADD_IN_PAT		DS.L	1
REGIS			DS.L	14
MU			DS.W	5040
MUS_END		DS.L	0
MUSI			DS.L	0
INS			DS.L	32*4

X1	DC.W	0
Y1	DC.W	0
X2	DC.W	0
Y2	DC.W	0
X3	DC.W	0
Y3	DC.W	0
X4	DC.W	0
Y4	DC.W	0
X5	DC.W	0
Y5	DC.W	0
X6	DC.W	0
Y6	DC.W	0
X7	DC.W	0
Y7	DC.W	0
X8	DC.W	0
Y8	DC.W	0
X1S	DC.W	0
Y1S	DC.W	0
X2S	DC.W	0
Y2S	DC.W	0
X3S	DC.W	0
Y3S	DC.W	0
X4S	DC.W	0
Y4S	DC.W	0
X5S	DC.W	0
Y5S	DC.W	0
X6S	DC.W	0
Y6S	DC.W	0
X7S	DC.W	0
Y7S	DC.W	0
X8S	DC.W	0
Y8S	DC.W	0
SPR1   DC.W   0
SPR2   DC.W   0
SPR3   DC.W   0
SPR4   DC.W   0
SPR5   DC.W   0
SPR6   DC.W   0
SPR7   DC.W   0
SPR8   DC.W   0

palette dc.w $0,$777,$666,$555,$444,$333,$222,$111,$766,$755,$643,$210,$020,$710,$140,$557
XX1	DC.W $D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0
YY1	DC.W $12,$12,$12,$12,$12,$12,$12,$12,$12,$12
XX2	DC.W $D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0
YY2	DC.W $12,$12,$12,$12,$12,$12,$12,$12,$12,$12
XX3	DC.W $D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0
YY3	DC.W $12,$12,$12,$12,$12,$12,$12,$12,$12,$12
XX4	DC.W $D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0
YY4	DC.W $12,$12,$12,$12,$12,$12,$12,$12,$12,$12
XX5	DC.W $D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0
YY5	DC.W $12,$12,$12,$12,$12,$12,$12,$12,$12,$12
XX6	DC.W $D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0
YY6	DC.W $12,$12,$12,$12,$12,$12,$12,$12,$12,$12
XX7	DC.W $D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0,$D0
YY7	DC.W $12,$12,$12,$12,$12,$12,$12,$12,$12,$12
POINT	DC.L BUFFER
BUFFER	INCBIN	 COORD.XY
	DC.L -1
MUZEXX		INCBIN	DEL33.MUS
BOING	incbin	 BOING.XY
	REPT	20
	DC.W	$F4,$A9,$F4,$A9
	ENDR
	DC.L -1
 	      ****************************************
TXT	DC.B $1B,'E  Hey! it seems to be my third demo',$d,$a
	dc.b '          for this Delirious 3',$d,$a,$d,$a
	dc.b '    I called it  MY FIRST BOBs DEMO',$d,$a
	dc.b "  because it's my first Blitter OBject",$d,$a
	dc.b ' rout (not optimised at all,but my first',$d,$a
	dc.b ' rout anyway). This demo contains 9 BOBs',$d,$a
	dc.b '  of 3 and 4 plans and a soundtrack at',$d,$a
	dc.b '   12.5 Khz. With this BOB rout I can',$d,$a  
	dc.b 'display: 20 BOBs 32*32 4 plans each VBL',$d,$a 
	dc.b "   but I'm sure that the Blitter can",$d,$a 
	dc.b 'display at least 30 BOBs 32*32 4 plans.',$d,$a,$d,$a
	dc.b 'Graphs and anims by ALF',$d,$a
	dc.b 'Muzix by ??? (Sorry for him)',$d,$a
	dc.b 'Code by Axel F.',$d,$a,$d,$a
	dc.b '		Squeeze the ESC key',0
FOND	DS.L	3000/4

end