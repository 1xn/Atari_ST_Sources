' TvÜ smÜ rutiner fîr att ladda in DEGAS och NEO bilder.
' Dessa Ñr saxade frÜn ATARI STen nummer 1/89
' Med modifering av Mikael NÑslund
'
ON ERROR GOSUB felhantering
bildval   ! gÜ till procedur bildval
'
PROCEDURE bildval
  CLEAR                     ! Rensa alla strÑngar och variabler
  CLS                       ! rensa skÑrmen
  rez&=XBIOS(4)             ! Vilken upplîsning Ñr vi i
  ALERT 1," VILKET BILDFORMAT VILL DU LADDA? |",1,"DEGAS|NEO|AVBRYT",a&
  IF a&=1                   ! Om vi vÑljer DEGAS
    default$="*.PI?"           ! Namn till filvÑljaren
    degas&=1                 ! Anger att vi har valt DEGAS
    filval                  ! Till filval proceduren
  ELSE IF a&=2              ! Om vi vÑljer NEO
    IF rez&<>3              ! Men om vi inte Ñr i LÜgupplîsning
      ALERT 1,"NEO Bilder kan endast|ses i LèGupplîsning|",1,"Oooops!",a&
      bildval          ! SÜ gÜr vi tillbaka till bildval
    ENDIF
    default$="*.NEO"
    neo&=1                  !Anger att vi har valt NEO
    filval
  ELSE
    sluta
  ENDIF
RETURN
PROCEDURE sluta
  ALERT 1,"Avbryta program?|",1,"JA|NEJ",a&
  IF a&=1
    END
  ENDIF
  bildval
RETURN
PROCEDURE filval
  FILESELECT #overskrift$,vag$,default$,namn$
  IF namn$="" OR RIGHT$(namn$)="/" ! Om vi inte vÑljer nÜn fil dÜ?
    ALERT 1,"Du har inte valt nÜgon bild!|",1,"Ooops|Avbryt",a&
    IF a&=2 ! DÜ kan vi avbryta programmet
      sluta
    ELSE    ! eller vi gîr ett fîrsîk till
      filval
    ENDIF
  ELSE     ! Och om vi vÑljer en fil sÜ direkt till procedur Ladda_bild(namn$)
    ladda_bild(namn$)
  ENDIF
RETURN
PROCEDURE ladda_bild(namn$)
  PRINT namn$
  IF neo&=1                     ! om vi har valt neobild
    BLOAD namn$,XBIOS(2)-128   ! dÜ hÑmtar vi en neobild
    VOID XBIOS(6,L:XBIOS(2)-128)
  ELSE IF degas&=1              ! Annars en degas bild
    BLOAD namn$,XBIOS(2)-34    ! -32 Ñr pallett data
    VOID XBIOS(6,L:XBIOS(2)-32)! En bild Ñr ju 32000 bytes stor
  ENDIF                        ! och dem extra 32 eller 128 bytes
  REPEAT                       ! Ñr fÑrger (inte sÜ insatt i det)..:-)
  UNTIL INP(2)                 ! Men vi kîr pÜ tills en tangent trycks ner.
  ' och fÜr ett felmeddelande om man har en STE med TOS 1.62
  ' ingen aning vad det kan vara fîr fel....;-)   NÜn som kan lista ut det?
  ' Man kan ocksÜ gîra sÜ att man sparar bilden i minnet och vÑntar en stund
  ' innan man visar den. Tex. vid ett speciellt tillfÑlle som Julen..;-D
  ' Nja, inte sÜ lÑnge kanske.
  ' Iaf. vi skriver dÜ sÜ hÑr istÑllet.
  ' a$=SPACE$(32128)  ! vi reserverar lite utrymme i a$ fîr en NEO bild
  ' men det gÜr bra att anvÑnda samma till DEGAS bilder oxo
  ' BLOAD namn$,VARPTR(a$) ! vi laddar in bilden pÜ adress a$
  ' HÑr i emellan kan man ju lÑgga en paus funktion eller nÜt
  ' och sen hÑmtas bilden och visas
  ' BMOVE VARPTR(a$),XBIOS(2)-34,32128
  ' VOID XBIOS(6,L:XBIOS(2)-32) ! och visar en bild
RETURN
PROCEDURE felhantering
  PRINT "TOS Error: ";ERR;"!"
  END
RETURN
