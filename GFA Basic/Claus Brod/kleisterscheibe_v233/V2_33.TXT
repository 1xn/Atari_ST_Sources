*************************************************************************
******* WAS NOCH NICHT IM BUCH STEHT - AKTUELLE INFORMATIONEN ZUR *******
************** VERSION 2.33 DER KLEISTERSCHEIBE, 23.01.92 ***************

Diese Datei enthÑlt Informationen Åber die Programme der KLEISTERSCHEIBE,
die (noch) nicht im SCHEIBENKLEISTER II oder im Handbuch zur KLEISTER-
SCHEIBE V2.0 enthalten sind. Lesen Sie sich die nachfolgenden Zeilen
bitte durch, bevor Sie Programme der KLEISTERSCHEIBE starten - vor allem
VORTEX-Platten werden's Ihnen danken.

Einige generelle Anmerkungen, was den Wandel von V2.2 zu V2.33 angeht:
Alle GFABASIC-Programme wurden nach GFA 3.0 portiert. Das alleine reicht
meistens schon, um sie auf dem TT lauffÑhig zu machen. Die BASIC-Programme
sind nun als LST-Dateien abgespeichert, damit es keine Probleme mit
der Hin- und Herkonvertierung mehr gibt.


**************
* SED V4.67H *
**************

1. Neuerungen
----------------

(schon in SED_400 enthalten, aber nicht im Buch beschrieben)

- DISK FREE: Anzeige des freien Speicherplatzes auf dem aktuellen Laufwerk

- SECTOR MAGIC: PufferprÅfsumme anpassen (wie CTRL-M)

- CTRL-Q: Sucht nach Muster, wirft Meldungen Åber Fundstellen auf die
  Fehlerseite

- RAM PRG_LOAD: Programm einlesen und dabei relozieren; nun kann man das
  Programm per Disassembler/RAM-Editor bearbeiten. Der Cursor wird auf
  den Anfang der Basepage des Programms positioniert.

- Anzeige der relativen Cursorposition ist per Mausklick von dezimal auf
  hexadezimal umschaltbar; befindet man sich beim Umschalten gerade in der
  Anzeige von FAT GRAPH, wird die Anzeige ebenfalls umgeschaltet

- Unterschiedliche Sektorgrîûen bis max. 2048 Bytes werden unterstÅtzt
  (auch im HARD-Modus)

- Scrollen per Mausklick auf den oberen oder unteren Randbereich des
  Anzeigefensters

- Doppelklick links setzt den Blockanfang, Doppelklick rechts das Blockende

- Doppelklick-Geschwindigkeit Åber OPTIONS DCLICK oder .INF-Datei
  einstellbar

- Pufferinhalt kann nur noch in einem dafÅr zustÑndigen UntermenÅ weg-
  geschrieben werden (verhindert Fehlgriffe)


(neu ab V4.4:)

- GFA-Dateifunktionen durch GEMDOS-Aufrufe ersetzt (mehr Fehlermeldungen)

- Anpassung an VORTEX- und SCSI-Platten (s.u.)

- verschiedene Routinen in Assemblerteil verlagert (-> schneller)

- Pufferinhalt wird nur noch bei echten énderungen zurÅckgeschrieben
  (CRC-Check)

- Anpassung an GFA 3.0x (keine GewÑhr! Beim Compilieren mit dem GFA-
  Compiler 3.0x muû die Option C+ gesetzt werden!)

- Hilfsseiten jetzt als externe ASCII-Datei SED_xxx.HLP, kann damit leicht
  persînlichem Geschmack angepaût werden

- FILE VERIFY: Fehler behoben, Ausgabe auch auf Bildschirm mîglich

- DIR ALL: Zeigt mehr Dateiattribute an (Hidden, Label, Folder)

- HARD COMMAND liefert die RÅckgabeparameter der Platte (z.B. bei
  MODE SENSE, REQUEST SENSE) in den Anzeigepuffer; der aktuelle
  Anzeigepuffer kann dem Kommando per DMA hinterhergeschickt werden
  (natÅrlich bei passenden Kommandos wie MODE SELECT etc.)

- Durchsuchen der Partitionentabelle im Rootsektor grÅndlicher;
  erkannt werden folgende Partitionenformate: CBHD (=ICD=SUPRA),
  VORTEX, ATARI vor AHDI 3.0

- beim Partitionieren schreibt SED 4.4 die Zeichenkette "SED4.4" in
  die OEM-Bytes (Bytes 2-7) der Bootsektoren. So kann man Bootsektoren
  leicht auf der Platte wiederfinden, falls der Rootsektor mal verloren-
  geht. AusfÅhrbare Bootsektoren, die von INSTALL geschrieben werden,
  enthalten diese Kennung nicht (dafÅr aber den Filenamen "CBHD    SYS").

- HELP-Taste liefert in jedem MenÅ die richtige Hilfsseite

- neues Format der INF-Datei (s.u.)

- verschiedene Fehler beseitigt

- aktuell ausgefÅhrte Funktion wird Åber den Funktionsbuttons angezeigt

- 14 anklickbare Boxen unter dem Anzeigefenster mit 7 Standardfunktionen
  (TOP=Cursor an Pufferanfang, END=Cursor ans Pufferende, ERR=Fehlerseite
  zeigen, =einen Sektor weiter, =eine Anzeigeseite weiter, =eine
  Anzeigeseite zurÅck, =einen Sektor zurÅck) und 7 frei belegbaren
  Funktionsbuttons (siehe Doku der INF-Datei)

- DISK QUICK: Gibt rekursiv einen Dateibaum aus; per Dateiauswahlbox kann
  der Startpunkt angegeben werden. Schneller als DIR ALL, zeigt aber
  weniger Infos an

- DISK COMPARE: Vergleicht den Inhalt zweier logischer Laufwerke

- DISK SAVE: Speichert Bootsektor, FATs und Wurzelverzeichnis des aktuellen
  Laufwerks in eine Datei ab (Schutz vor versehentlichem öberschreiben)

- DISK LOAD: LÑdt die mit DISK SAVE erstellte Datei wieder ein und
  restauriert so Bootsektor, FATs und Wurzelverzeichnis eines Laufwerks

- FAT SHOW: Holt eine Clusternummer, liest passenden FAT-Sektor ein,
  positioniert Cursor auf die Clusterposition in der FAT und gibt den
  Inhalt dieser Clusterposition aus

- FILE CONCAT: Verbindet zwei Dateien zu einer dritten

- FILE CUT: Teilt geîffnete Datei an der aktuellen Cursorposition in
  zwei Dateien auf

- DIR RMDIR: Lîscht ein Unterverzeichnis (Laufwerk selektieren, per
  Dateiauswahlbox îffnen, dann OK klicken) einschlieûlich Inhalt (fragt
  dabei nach)

- HARD SEARCH: Untersucht jeweils die GerÑte 0 und 1 der Targets 0 bis 7;
  zeigt gefundene GerÑte an ("Timeout"=nix da, "ok"=Platte da)

- HARD INFO: Gibt Belegung der selektierten Platte aus (in Sektoren und
  Prozent), Ñquivalent mit HDX INFO

- HDX SAVE: Speichert Root- und Bootsektoren der ausgewÑhlten Platte

- HDX RESTORE: Holt Root- und Bootsektoren zurÅck

- INFOS SIEBEN: Gibt die Belegung der sieben frei belegbaren Buttons aus

- INFOS BUTTONS: Gibt öbersicht Åber MenÅs aus

- INFOS CRC: Berechnet CRC-PrÅfsumme eines markierten Blocks

- INFOS GET INFO: INF-Datei einlesen (wie OUT/IN GET INFO)

- OPTIONS MEMCLR: Gibt Speicherbelegung unter SED aus (= INFOS SYSTEM),
  rÑumt Speicher ein wenig auf

- OPTIONS DCLICK: Stellt Doppelklickgeschwindigkeit ein

- OPTIONS HDSEL: Stellt SED auf einen gewÅnschten Plattentyp ein
  (0 = SH205/SH204, 1 = MEGAFILE 30/60, 2 = VORTEX, 3 = SCSI-Platten,
  auch MEGAFILE 44).
  *** WENN SIE VORTEX-PLATTEN VERWENDEN, MöSSEN SIE DEN SED UNBEDINGT ***
  *** IN DEN VORTEX-MODUS BRINGEN! *** Mehr dazu s.u.

- RAM SHOW: Zeigt RAM-Bereich kontinuierlich an (man betrachte beispiels-
  weise den Bereich ab $400)

- FUNKTION PEXEC: FÅhrt anderes Programm aus dem SED heraus aus; GEM-
  Programme laufen nicht unbedingt

- FUNKTION MENö: Schaltet auf MenÅleiste um, aus der man die Accessories
  erreichen kann. In der MenÅleiste findet man ebenfalls einen neuen
  MenÅpunkt namens PEXEC.

- FUNKTION RESET: Warm- oder Kaltstart des Rechners. Nach einem Kaltstart
  sind resetresidente Programme gelîscht!

- FUNKTION SOUND: Erlaubt die Umschaltung des Bits 6 im Port A des
  Soundchip (wird von Hardwareerweiterungen zur Umschaltung benutzt,
  z.B. HYPER DENSITY, Hypercache...)

- FUNKTION CPU: Miût die CPU-Geschwindigkeit in MHz; alle Interrupts
  bleiben an, darum geht die gemessene Geschwindigkeit auch in die
  Knie, sobald man die Maus heftig bewegt

- CTRL-+ (CTRL und Plus-Zeichen): Addieren zweier Zahlen (hex/dez
  gemischt), Ausgabe des Ergebnisses in hex und dez.

- CTRL-- (CTRL und Minus-Zeichen): Subtraktion, zweite Zahl wird von
  erster abgezogen, Ausgabe des Ergebnisses in hex und dez.


(neu ab V4.67:)

- lÑuft unter OverScan und in den TT-Modi

- Sektoren pro Cluster beim Partitionieren fÅr jede Partition einstellbar

- neue Optionen FILE COPY (tut, was der Name sagt) und FILE CRC
  (CRC-PrÅfsumme Åber eine Datei berechnen)

- DISK BOOT zeigt sowohl die Werte aus dem Bootsektor als auch aus dem
  BIOS-Parameterblock an

- Per OUT PRINTER kînnen Sie einzelne Zeilen an den Drucker ausgeben;
  nÅtzlich fÅr Kommentare im Ausdruck.

- die Eingabeboxen haben jetzt einen OK- und einen Abbruch-Button;
  auch die Meldung "Schreibschutz hilft nix" kann jetzt mit "Abbruch"
  quittiert werden

- FILE DUMP gibt auch eine DateilÑnge aus

- HARD RESTORE fragt vor dem Schreiben sicherheitshalber nach

- Beim Klick auf die Uhr erscheint das Datum

- FUNCTION EXEC funktioniert sicherer

- DISK CHECK markiert jetzt fehlerhafte Sektoren in der FAT; beim
  PrÅfen werden bereits als fehlerhaft erkannte Sektoren Åbersprungen

- FAT TEST und FAT GRAPH Ñrgern Sie nicht mehr mit gar so vielen
  Alertboxen, wenn Leichen-Cluster gefunden werden

- FAT GRAPH gibt jetzt kleine Buchstaben aus; der Ausgabebereich kann
  nach oben und unten gescrollt werden

- INFO SYSTEM zeigt an, ob ein Blitter vorhanden ist

- einige Fehler beseitigt, u.a. derjenige, der dazu fÅhrte, daû bei
  sehr vollen oder sehr groûen Partitionen der interne Speicher
  schnell erschîpft war


2. WICHTIG: Anmerkungen zum VORTEX/SCSI-Modus
---------------------------------------------

(Wenn im folgenden kurz von "Vortex-Platten" die Rede ist, so ist
damit die Vortex-HDplus-Reihe gemeint. Die Platten der DataJet-Reihe
verhalten sich wie SCSI-Laufwerke und sind daher auch im SCSI-Modus
zu betreiben.)

Seit der Version 4.0 verwendet SED im Plattenmodus mehr Plattenkommandos,
um bei ATARI-Platten das Formatieren etc. sicherer zu gestalten. Leider
vertragen sich insbesondere die folgenden Kommandos nicht mit VORTEX-
und SCSI-Platten:

    MODE SENSE
    MODE SELECT
    REQUEST SENSE
    SHIP (nur bei Vortex-Platten)

Bei SCSI-Platten ist der Effekt harmlos: Sie lieûen sich einfach nicht
formatieren oder partitionieren. Das liegt daran, daû sie auf MODE SENSE
und REQUEST SENSE mit einem anderen Datenformat antworten als die
ATARI-Platten (damit sind im folgenden SH204, SH205, MEGAFILE 20, 30
und 60 gemeint; die MEGAFILE 44 zÑhlt ebenfalls zu den SCSI-Platten),
was den SED verwirrte.

Viel schlimmer ist, daû Vortex-HDplus-Platten (ab BIOS-Version 1.06)
das Kommando MODE SENSE nicht wie alle anderen Platten als Kommando
zum Parameterlesen interpretieren, sondern als Befehl zum öberschreiben
von Systemsektoren! Das hat bei einigen Vortex-Besitzern schon
zum Datenverlust gefÅhrt. Das Gemeine daran ist, daû im Vortex-Handbuch
darÅber nichts zu lesen ist; MODE SENSE existiert Vortex-offiziell
Åberhaupt nicht, und wir hatten darum erwartet, daû die Vortex-Platten
mit einer einfachen Fehlermeldung antworten - und nicht einfach
drauflosschreiben! Inzwischen sind wir schlauer.

Sicher sehen Sie nun ein, daû es Ñuûerst wichtig ist, daû Sie den SED
schon VOR DEM START auf den Vortex-Modus einstellen. Das geschieht Åber
die INF-Datei (siehe dort). Findet der SED beim Start keine INF-Datei,
schaltet er zur Sicherheit automatisch in den Vortex-Modus; wenn Sie
andere Platten besitzen, mÅssen Sie die fehlende Justierung dann per
OPTIONS HDSEL nachholen. Dort wird auch der aktuelle Modus angezeigt
(0 = SH204/SH205, 1 = MEGAFILE 30/60, 2 = VORTEX, 3 = SCSI).

SCSI- und Vortex-Modus kennt SED erst ab Version 4.4. Vom Gebrauch der
Version 4.0 mit Vortex-Platten mÅssen wir aus leidvoller Erfahrung
abraten.

Da bei Vortex-Platten nicht einmal das Park-Kommando den Opcode hat,
den es laut SCSI/ACSI-Standard sein sollte, haben wir auch das angepaût.
Formatieren und Partitionieren sowie Installieren des Treibers funktio-
niert nun im Vortex-Modus; wir haben einfach auf alle Kommandos ver-
verzichtet, die die Vortex-Platten nicht kennen (REQUEST SENSE, MODE
SENSE, MODE SELECT). Da dies aber sehr wichtige Kommandos sind, wenn man
Åber auftretende Fehler oder Plattenparameter Bescheid wissen will, ist
die ganze Format-Prozedur mit Vortex-Platten leider nicht so sicher, wie
wir uns das wÅnschen wÅrden. Unsere Empfehlung: Formatieren Sie mit der
VORTEX-Software und partitionieren Sie *danach* per SED, wenn Sie den
CBHD-Treiber und seine 12 Partitionen nutzen wollen. Sie kînnen auch
per Vortex-Software partitionieren, wenn Sie nicht mehr als 8 Partitionen
brauchen. Die Installation von CBHD.SYS lÑuft Åber SED. SED unterstÅtzt
nicht das FINIT-Kommando der Vortex-Platten.

Um dem ein wenig die Spitze zu nehmen: Programme, die nur Åber den
Treiber auf Vortex-Platten zugreifen, haben damit keine Probleme.
Also bitte keine Panik. Es geht nur um spezielle Harddisk-Kommandos,
wie sie beispielsweise in SED und CHECKHD verwendet werden (mÅssen).
Trotzdem mÅssen Sie den SED fÅr den Vortex-Modus konfigurieren, auch
wenn Sie nur die allgemeinen Funktionen im Sektor- oder FAT-Modus
nutzen wollen, weil der SED beim Start oder beim bloûen Wechseln in
den HARD/HDX-Modus direkt auf DMA-GerÑte zugreift.

Getestet wurden die Vortex-Routinen mit einer Vortex HDplus40,
von einigen Lesern auch mit anderen HDplus-Platten. Eine zusÑtzliche
Schwierigkeit beim Formatieren von Vortex-Platten: Die Vortex-Hardware
(!) erwartet am Anfang des Rootsektors spezielle Parameter (Zeit
zwischen Autoparkversuchen, Motorabschaltzeit...); dort steht aber
normalerweise das Bootprogramm fÅr den Treiber. Wir haben dem neuen
SED Root- und Bootsektoren fÅr Vortex-Platten beigelegt (VORTEXRT.DAT
und VORTEXBT.DAT), die Sie statt der Standard-Sektoren SEDROOT.DAT
und SEDBOOT.DAT verwenden sollten.

Der Anfang eines Vortex-Rootsektors sieht (ab BIOS-Version 3.0) so
aus:

Offset      LÑnge in Bytes  Inhalt
-------------------------------------------------
0           2               Sprunganweisung
2           1               Flag fÅr Cache (0 = kein Cache)
                            wird nur vom Vortex-Treiber beachtet, ebenso
                            die nÑchsten beiden Parameter
3           1               maximale TransferlÑnge
4           2               Cachegrîûe in Sektoren
6           2               Flag fÅr automatisches Parken (0 = nicht
                            automatisch parken)
8           2               Zeit bis zum Auto-Parken in Sekunden
                            (voreingestellt: 25s)
10          1               immer $F1
11-24       14              reserviert
25          1               Flag fÅr automatische Motorabschaltung
                            (0 = Motor bleibt an)
26          2               Zeit bis zur Motorabschaltung in Sekunden
28          1               Tastenkombination fÅr Motorabschaltung
                            (nur fÅr Vortex-Treiber)
ab 29                       Vortreiber

Wenn Ihnen die Voreinstellung (automatisches Parken nach 25 Sekunden,
keine automatische Motorabschaltung) nicht paût, kînnen Sie das ja
im HARD-Modus des SED anhand dieser Tabelle Ñndern. War der Rootsektor
vor den énderungen ausfÅhrbar, sollten Sie ihn auch danach wieder
ausfÅhrbar machen (CTRL-M). WARNUNG: Wenn Sie die automatische
Motorabschaltung der Vortex-Platten (ab BIOS 3.0) aktivieren, kommt
die Platte erst wieder hoch, wenn Sie das Kommando MOTOR CONTROL
(Vortex-EigenprÑgung: $1f,0,0,0,x,0; x=1: Motor wieder an) an sie
abschicken; im SED geht das per HARD COMMAND. Wir empfehlen, den
Motor aus SicherheitsgrÅnden immer laufen zu lassen.

Im SCSI-Modus versucht der SED, die RÅckgabedaten bei REQUEST
SENSE und MODE SENSE nach SCSI-Standard zu interpretieren; Platten,
die sich einigermaûen daran halten, sollten keine groûen Probleme
machen. Probiert haben wir das bei folgenden SCSI-Laufwerken:

    Syquest SQ555 (MEGAFILE 44)
    Quantum P40 (protar 40DC, LACOM-SD-Reihe)
    Quantum P105
    Seagate ST157N-1
    Seagate ST296N-1

Wenn Sie eine andere SCSI-Platte besitzen, berichten Sie doch mal
kurz von Ihren Erfahrungen. Wir passen den SED stÑndig weiter an.
Der Harddiskteil des SED (HARD- und HDX-MenÅ) funktioniert NICHT
mit Platten, die vom ACSI-Standard abweichen (c't-Adapter, Maude-
Adapter wie in den F&H-Platten, angeblich auch Rhothron). Wir besitzen
keine solche Platte. Wenn ein Leser Lust hat, die DMA-Routinen des
SED (BHDI.S) an solche Platten anzupassen, mîge er sich doch bitte
bei uns melden.


3. Neues Format der INF-Datei
-----------------------------

Anhand der folgenden Beispiel-INF-Datei sei das neue Format vorgestellt:

-------------------------------------------------------------Zl.
2         ' 0=SH205  1=MEGAFILE  2=Vortex  3=SCSI  ....     | 1
1         ' Cursoranzeige dez.                              | 2
1         ' Uhr ein                                         | 3
0         ' UntermenÅ (HauptmenÅ)                           | 4
70        ' Dclick                                          | 5
01,01,01,09,12,06,05        ' UntermenÅ  1 2 3 4 5 6 7      | 6
03,06,11,06,14,07,07        ' Button     1 2 3 4 5 6 7      | 7
TOPENDERR    BOODRVFREMENROODISSHP                  | 8
-------------------------------------------------------------

Zeile 1: Voreinstellung des Festplattenmodus:
    0 = SH204/SH205, MEGAFILE 20
    1 = MEGAFILE 30, MEGAFILE 60
    2 = VORTEX-Platten (Vortex HDplus)
    3 = SCSI-Platten (auch MEGAFILE 44 und DataJets von Vortex)
Zeile 2: Modus der Cursorpositionsanzeige (1=dezimal, 0=hexadezimal)
Zeile 3: Anzeigeflag fÅr Uhrzeit (0=Uhr aus, 1=Uhr an)
Zeile 4: Nummer des UntermenÅs, in das beim Start automatisch gewechselt
         werden soll:
    0 = HauptmenÅ
    1 = DISK
    2 = FAT
    3 = FILE
    4 = SECTOR
    5 = HARD
    6 = RAM
    7 = OUT/IN
    8 = DIR
    9 = FUNKTION
    10 = unbelegt
    11 = unbelegt
    12 = HDX
    13 = INFOS
    14 = OPTIONS

Zeile 5: Geschwindigkeit des Doppelklicks zum Blockmarkieren
Zeile 6+7: Funktionsbelegung der sieben frei belegbaren Funktionsbuttons;
         in Zeile 6 steht fÅr jeden Button die Nummer des UntermenÅs, in
         dem die fÅr den Button vorgesehene Funktion zu finden ist;
         Zeile 7 spezifiziert fÅr jeden Button die Nummer der Funktion
         innerhalb eines UntermenÅs.
Zeile 8: Jeweils drei Buchstaben fÅr die 14 Funktionsbuttons; die letzten
         sieben (oben ab "BOO...") frei belegbar

Danach: Druckeranpassung (evtl.), siehe dazu Buch bzw. Handbuch zur
        KLEISTERSCHEIBE 2.0


*************
* TED V5.25 *
*************

- Doppelklick links/rechts markiert Blîcke (wie in SED)

- Mausklick auf Randbereiche des Arbeitsfensters scrollt um jeweils
  eine Zeile

- Anpassung an HYPER-DENSITY-Formate (s. HYPERFORMAT)
  ACHTUNG: Anders als im Buch beschrieben, gibt es doch STs, die beim
  Einlesen von HYPER-DENSITY-Tracks mehr als 7168 Bytes liefern! Ist
  wohl abhÑngig vom DMA-Chip.

- Alertbox beim HYPER-DENSITY-Format erscheint nicht mehr (war zu lÑstig)

- Anpassung an OverScan

**************
* CD-Monitor *
**************

- Doppelklick links/rechts markiert Blîcke

- Mausklick auf Randbereiche des Arbeitsfensters scrollt um jeweils
  eine Zeile

- AUDIO TIME schneidet aus einer Musik-CD kurze StÅcke heraus und
  wiederholt sie

- AUDIO FILE liest "Kommandodateien" ein und fÅhrt sie aus. Zum Format
  der Kommandodateien: Eine Zeile mit drei Sternchen ("***") kÅndigt ein
  Kommando in der folgenden Zeile an; alle anderen Zeilen sind Kommentare.
  Die Kommandos sind 10 Bytes lang und entsprechen den ACSI-Kommandos des
  CDAR504. Auf das letzte Kommandobyte folgen noch zwei Parameter: Wie oft
  soll das Kommando wiederholt werden, und wie groû ist der Zeitabstand
  zur nÑchsten Kommandozeile? Beispiel:

    ***
    17,0,5,5,5,5,7,7,0,128,2,2
    ' AUDIO PROGRAM mit Start- und Endzeit, 2facher Wiederholung und
    ' 2 Sekunden Abstand zum nÑchsten Kommando

- Anpassung an OverScan

***********************
* CBHD-Plattentreiber *
***********************

- Das Booten von Platte kann mit der ALTERNATE-Taste abgebrochen werden.

- Wenn Sie beim Booten die Shift-Taste drÅcken, kînnen Sie auswÑhlen,
  welche Plattenlaufwerke eingebunden werden; CBHD zeigt dann die Adresse
  des Laufwerks an (zB T0G0 = Target 0, GerÑt 0) und wartet auf 'y'
  (Platte einbinden) oder 'n'.

(seit Version 3.5:)

- erste Anpassungen an AHDI 3.0x in der punptr-Struktur:

    typedef struct
    {
        int puns;           /* Anzahl der physikalischen Laufwerke */
        char pun[16];       /* FÅr jedes GEMDOS-Laufwerk ein Eintrag
                               mit Target- und GerÑtenummer (siehe
                               KLEISTER II bzw. Handbuch zur KLEISTER-
                               SCHEIBE 2.0) */
        long p_start[16];   /* Startsektor jeder Partition */
        long p_cookie;      /* Magic "AHDI" */
        long p_cookptr;     /* Zeiger auf p_cookie; an p_cookie und
                               p_cookptr erkennt man AHDI 3.0 */
        unsigned p_version; /* Treiberversion (AHDI 3.0: $0300) */
        int p_max_sector;   /* maximale Sektorgrîûe in Bytes */
    } PUN_INFO;

  Auf diese Struktur zeigt die Systemvariable punptr ($516) nach dem
  Start des Treibers. Beim CBHD liegt vor der Struktur zusÑtzlich eine
  XBRA-Struktur wie im KLEISTER II oder im Handbuch zur KLEISTERSCHEIBE
  2.0 beschrieben. CBHD unterstÅtzt nun also nur noch maximal 14
  Partitionen statt vorher 30 (konnte man eh nicht nutzen, weil
  GEMDOS beispielsweise beim Zugriff auf Laufwerk Z: Feuerwerke
  veranstaltet).

- noch etwas kompatibler (bootdev wird wieder komplett restauriert)

- versteht ICD/SUPRA-Rootsektoren ohne énderung (12-Partitionen-Format),
  Vortex sowieso

- Anpassung an STE

- unterstÅtzt Medienwechsel bei Wechselplatten; anders als AHDI liest
  CBHD beim Medienwechsel die Daten aller angeschlossenen Platten neu
  ein. Dadurch ist es mîglich, beim Booten ein Medium mit drei Parti-
  tionen einzulegen und spÑter auf ein Medium mit 5 oder 6 Partitionen
  zu wechseln. CBHD wird durch die Wechselerkennung NICHT langsamer
  (ganz anders als AHDI 3.0).

  Beim Wechsel simuliert CBHD auf allen Partitionen einen Medienwechsel;
  beim nÑchsten Zugriff wird dann die komplette Partitionenstruktur neu
  eingelesen. In gewissen Zeitintervallen prÅft die treiberinterne
  mediach()-Funktion die beim Kaltstart angeschlossenen (!) Platten auf
  einen Wechsel (Ñhnelt ein wenig dem Vorgehen des Disketten-BIOS).
  Das alles sollte zusammen gewÑhrleisten, daû ein Wechsel nie verpaût
  wird. Die Handhabung des Wechsels ist die gleiche wie bei Disketten:
  Man sollte das Medium nicht entfernen, wenn gerade darauf zugegriffen
  wird, und man sollte auch nicht versuchen, auf die Wechselplatte
  zuzugreifen, bevor man nicht das neue Medium eingelegt hat. Der
  Treiber kommt damit zwar zurecht und meldet einen Fehler per Alertbox,
  doch leider kann es vorkommen, daû sich in solchen FÑllen der DMA-
  Bus merkwÅrdig benimmt (man kennt das ja vom Plattenparken und anderen
  Begebenheiten). Im DESKTOP kann man ESC drÅcken, um ein Fenster zu
  aktualisieren; auch beim ôffnen eines Ordners oder dem Anklicken eines
  Programms wird der Wechsel erkannt.

  Wichtig: Nur diejenigen Laufwerke, die beim Kaltstart angeschlossen
  waren und auf denen mindestens eine Partition erkannt wurde, werden
  auf Medienwechsel Åberwacht!

  GEMDOS vergiût beim Medienwechsel alle Informationen, die es zuvor
  Åber die betroffenen Laufwerke hatte. Der interne GEMDOS-Cache
  wird gelîscht und alle Pfade werden zurÅckgesetzt. Das macht sich
  in Applikationen und in der Dateiauswahlbox durch Meldungen wie
  "Die Anwendung kann das Objekt nicht finden" bemerkbar. Diese
  Erscheinung ist normal und nicht schlimm - man setze den Pfad einfach
  neu. Wechseln Sie NIE ein Medium, solange noch eine Datei geîffnet
  ist - der Inhalt dieser Datei geht dann in der Regel verloren!
  Tip: Geben Sie der Wechselplatte die hîchste ACSI-Targetnummer;
  sie wird dann als letzte eingebunden, und beim Wechseln Ñndert sich
  dann nur die Lage der Partitionen auf der Wechselplatte.

  Getestet wurde der Wechsel bisher nur bei der MEGAFILE 44. Der Treiber
  sollte bei allen SCSI-Wechselplatten funktionieren, die nach einem
  Wechsel die SCSI-Fehlermeldung $28 liefern.

- Beim Schreiben eines Plattenbootsektors wird ebenfalls eine Wechsel-
  meldung ausgelîst (analog zum Floppy-BIOS).

- Auf vielfachen, drÑngenden Wunsch: Bei "Arbeit sichern" wird das
  DESKTOP.INF immer auf die gerade aktive Partition geschrieben. Man îffne
  beispielsweise im Desktop das Fenster fÅr Partition F:, klicke "Arbeit
  sichern", und schon ist das DESKTOP-Info auf F: gespeichert; es wird
  auch das richtige Fenster aktualisiert. Wir muûten zu einem... naja...
  ziemlich coolen Hack greifen (Puristen bitte wegschauen), um das zu
  bewerkstelligen, aber es funktioniert ohne Zugriff auf illegale
  Variablen und das auf allen uns bekannten TOS-Versionen (1.0, 1.2
  und 1.4). Es mag sein, daû dieser Hack bei anderen, neuen TOS-Versionen
  nicht mehr funktioniert, aber das Schlimmste, was passieren kann, ist
  (hoffentlich), daû das DESKTOP.INF doch wieder auf C: abgespeichert
  wird. FÅr die grundlegende Idee zu diesem Hack sei an dieser Stelle
  JÅrgen Lock gedankt, der sich auch sonst durch permanente konstruktive
  Anteilnahme am KLEISTER hervorgetan hat.


Mit diesem Update erhalten Sie neben der alten Version 3.8 des CBHD
eine aktuelle Version 4.10, die auch das AHDI3-Format unterstÅtzt und viele
neue Mîglichkeiten bietet. Dazu wird auch ein neues CBHDINST geliefert;
unser Leser Michael Schwingen hat das Programm in Turbo C neu
implementiert. Damit ist das Programm einerseits relativ kurz geblieben,
andererseits ist es wesentlich besser wartbar. Auûerdem haben wir das
Programm nun CBHDCONF genannt, weil das den Sinn dieses Programmes
doch wesentlich besser trifft.

Neuigkeiten seit CBHD 3.7:

- Bit 1 im R/W-Flag der BIOS-Funktion Rwabs() wird unterstÅtzt (UnterdrÅckung
  einer Wechselmeldung). Die Erweiterung der Rwabs()-Funktion auf 32-Bit-
  Sektornummern wurde ebenfalls Åbernommen.
  
- Der Datentransfer an ungerade Adressen wurde etwas beschleunigt. Da
  solche Transfers normalerweise selten vorkommen, spÅrt man das im
  praktischen Betrieb allerdings kaum.

- Die Wechselmeldung nach dem Beschreiben eines Bootsektors kommt genau an
  der Stelle wie beim Diskettentreiber des BIOS. Trotzdem gibt es Programme,
  die den Bootsektor einer Partition beschreiben und nicht damit rechnen,
  daû sie dann wie bei einer Diskette eine Wechselmeldung beim
  darauffolgenden Zugriff erhalten. Dazu gehîrt zum Beispiel HINSTALL
  aus dem HDX-Paket von ATARI. Um auch mit solchen Programmen zu
  harmonieren, ist die Wechselmeldung nach Beschreiben des Bootsektors
  abschaltbar.

- Neuer Nachlaufhemmer fÅr die Diskettenlaufwerke; funktioniert nun besser
  bei zwei angeschlossenen Laufwerken. DafÅr sei JÅrgen Lock gedankt.
  
- Man kann den Treiber so konfigurieren, daû er bestimmte Targets oder
  GerÑte beim Booten nicht untersucht. Das ist vor allem wichtig fÅr
  den Supercharger oder fÅr die Conner-Platten in der STacy. Der Supercharger
  mag regulÑre ACSI-Zugriffe nicht besonders; man trage dem Rechnung, indem
  man den Treiber erst gar nicht auf die Targetadresse des Superchargers
  zugreifen lÑût. Der Controller der Conner-Platten in der STacy
  (und einiger Fujitsu-Platten) stÅrzt ab, wenn man sich bei ihm hîflich
  nach einem zweiten Laufwerk erkundigt. Um das zu vermeiden, lasse man
  nur noch das GerÑt 0 an der betreffenden Targetnummer abfragen.
  
  Die neue Option verbessert nicht nur die KompatibilitÑt, sondern kann
  auch das Booten beschleunigen. Meistens hat man ja doch immer nur eine
  Platte an seinem ST hÑngen, und es ist pure Zeitverschwendung, alle
  Target- und GerÑtenummern zu durchlaufen. In diesem Falle konfiguriert
  man den Treiber so, daû er nur noch eine Target- und GerÑtenummer
  untersucht, und das Booten wird nochmals deutlich fixer.

- Neue Methode fÅr das Booten von Accessories von beliebigen Laufwerken;
  vertrÑgt sich viel besser mit Programmen, die im AUTO-Ordner ungewîhnliche
  VBL-Manipulationen machen.

- Nach der Meldung, es kînne eventuell ein Virus im System sein, wird
  normalerweise auf eine Taste gewartet. Das ist nun abschaltbar.
  CBHD erkennt nun auch, wenn die hdv-Vektoren von einer anderen Kopie
  des CBHD verbogen wurde, und meldet dies nicht mehr als potentielle 
  Gefahr. Hat man zwei bootfÑhige Platten mit CBHD darauf, installiert
  sich CBHD beim Booten nur noch einmal und spart so Speicher. Das
  nachtrÑgliche Starten vom Desktop ist dagegen weiterhin mîglich.
  
- Eine spezielle CBHD-Version fÅr den Gebrauch mit MIDI-Tastaturen ist
  verfÅgbar. Das Problem dabei: Beim Booten ist der jeweilige Tastatur-
  treiber noch nicht gestartet, so daû man TastendrÅcke auf der MIDI-
  Tastatur nicht Åber die normalen BIOS- und GEMDOS-Funktionen abfragen
  kann. CBHD muû daher direkt an die Tastatur. Die Anpassung stammt von
  Armando Zimmermann, dem ich dafÅr danke.

- Die Bootlaufwerke fÅr AUTO-Ordner und Accessories sind jetzt getrennt
  wÑhlbar. DrÅckt man wÑhrend des Bootens genau eine Taste, wird versucht,
  das als Bootlaufwerk fÅr AUTO-Ordner und Accessories zu interpretieren.
  DrÅckt man zwei Tasten, wird der erste eingegebene Buchstabe als
  Kennung des Bootlaufwerks fÅr den AUTO-Ordner interpretiert, der zweite
  bestimmt, woher Accessories und DESKTOP.INF/NEWDESK.INF geholt werden.

- Der Åble Hack, dem zu verdanken ist, daû die Option 'Arbeit sichern'
  im DESKTOP das DESKTOP.INF auch auf andere Laufwerke als C und A
  schreiben kann, wurde etwas entschÑrft. Insbesondere wird bei 'Arbeit
  sichern' das DESKTOP.INF/NEWDESK.INF nun auf das Laufwerk zurÅck-
  geschrieben, von dem es geladen wurde. Dies lÑût sich um einiges
  sauberer bewerkstelligen als die vorige Lîsung. Daû ich diese Option
  Åberhaupt eingebaut und im Treiber belassen habe, ist der bemerkens-
  werten Nachfrage vieler Leser nach einem solchen Trick zu verdanken.
  Und praktisch ist so etwas ja auch!
  
  Um allen KompatibilitÑtsproblemen durch diesen Trick aus dem Wege
  zu gehen, habe ich einige Verbesserungen angebracht. ZunÑchst ist
  der Traphandler, der fÅr diesen Zweck installiert wird, nun auch
  an den 68030 angepaût. Auûerdem ist die Option komplett abschaltbar.
  Um auch bei abgeschalteter Option einen Ñhnlichen Komfort zu erreichen,
  hat das Accessory CBHDINST eine Option, um das aktuelle
  DESKTOP.INF/NEWDESK.INF auf ein beliebiges Laufwerk, ja sogar
  an eine beliebige Stelle im Dateibaum abzuspeichern. Allerdings hat
  das einen Haken: VerÑndert man eine Einstellung im DESKTOP, wird
  diese énderung erst beim Starten eines Programms aus dem DESKTOP
  heraus in den DESKTOP-eigenen Shell-Puffer geschrieben. FÅr das
  Accessory bedeutet das, daû die neue DESKTOP-Konfiguration erst
  nach dem Starten eines Programmes abgespeichert werden kann. Auf
  sauberem Wege ist leider nicht mehr zu machen.

- Die GEMDOS-Sektorpuffer werden von CBHD erweitert. Die Programme
  CACHxxxx von ATARI und CACHEADD von der KLEISTERSCHEIBE haben damit
  ausgedient - sie kînnen bei entsprechender Konfiguration des CBHD
  aus dem AUTO-Ordner verschwinden. Damit wird das Booten wieder ein
  StÅckchen schneller. Auûerdem kann man im CBHD die Grîûe der beiden
  Pufferbereiche unabhÑngig voneinander einstellen und so auf seine
  individuellen BedÅrfnisse abstimmen. Mit CACHxxx und CACHEADD ging
  das ja nicht so ohne weiteres.
  
  NÅtzlich sind CACHxxx und CACHEADD nunmehr allenfalls dann,
  wenn man ohne Booten die Auswirkung verschiedener Puffergrîûen
  auf die Geschwindigkeit des Dateizugriffes ausprobieren will -
  oder aber natÅrlich dann, wenn man CBHD nicht verwendet.

  DrÅckt man wÑhrend des Bootens die CTRL-Taste, werden weder
  Ordner- noch Sektorpuffer erweitert. Wir verdanken diese Option
  der öberredungsgabe unseres nimmermÅden Lesers Chris Evelo.
    
- XGM- und BGM-Partitionen, wie sie ATARIs HDX seit der Version 3.x
  anlegt, werden erkannt und richtig verwaltet. Damit kann man mit
  CBHD Partitionen bis zu einer Grîûe von 256 MB verwalten. Dazu
  setzt CBHD den gleichen Trick wie AHDI ein: Mehrere physikalische
  Sektoren werden zu einem grîûeren logischen Sektor zusammengefaût.
  Dadurch steigt die logische Sektorgrîûe auf 1024, 2048, 4096 Bytes
  oder mehr. Auf diese Weise kann man auch mit 32768 logischen
  Sektoren (mehr logische Sektoren verwaltet GEMDOS nicht richtig)
  mehr als 16 MB pro Partition erreichen.
  
  An dieser Stelle: Immer wieder wird behauptet, daû es in TOS 1.04
  mîglich sei, bei einer logischen Sektorgrîûe von 512 Bytes
  Partitionen bis 32 MB anzulegen und damit zu arbeiten. Mir ist
  zwar bisher kein Fall bekannt, wo dies nachweislich zu Datenverlusten
  gefÅhrt hÑtte, aber dennoch mîchte ich davor warnen. Es gibt im
  GEMDOS des TOS 1.04 mindestens noch eine Stelle, die den sicheren
  Betrieb solcher Partitionen gefÑhrdet. Es mag sein, daû dieser Teilbereich
  des GEMDOS-Codes nur in AusnahmefÑllen benutzt wird, aber es gibt
  nach wie vor einen Vorzeichenfehler, der verhindert, daû mehr als
  32768 logische Sektoren sicher verwaltet werden kînnen.
  
  Aber selbst wenn dieser Fehler nie zuschlagen sollte, handelt man
  sich Probleme ein, wenn man versucht, bei 512 Bytes Sektorgrîûe mehr
  als 16 MB in einer Partition unterzubringen - spÑtestens dann, wenn
  man seine (Wechsel-)Platte einmal bei einem Bekannten an den
  Rechner anschlieût und dieser Rechner eine alte TOS-Version
  (TOS 1.00 oder TOS 1.02) eingebaut hat. Die Datenverluste in einem
  solchen Fall wage ich mir kaum vorzustellen.
  
  Es gibt einige Partitionierungsprogramme, die dennoch mehr als
  16 MB pro Partition auch bei 512 Bytes Sektorgrîûe erlauben, wenn
  TOS 1.04 im Rechner eingebaut ist. Dazu zÑhlen SCSITool und
  die ICD-Software. CBHD kommt auch mit solchen Partitionen zurecht,
  aber aus den dargelegten GrÅnden garantiere ich hier fÅr nichts.

  Eine Hiobsbotschaft: Die mit diesem Update ausgelieferte SED-Version
  unterstÅtzt noch keine BGM- oder XGM-Partitionen. Wir schreiben den
  SED zur Zeit radikal um, und bis daraus ein stabiles Ergebnis folgt,
  braucht es noch seine Zeit. Wenn Sie also Partitionen mit mehr als
  16 MB anlegen wollen, mÅssen Sie vorlÑufig einen anderen Partitionierer
  verwenden - am besten den, der bei Ihrer Platte mitgeliefert wurde.
  Nach dem Partitionieren kînnen Sie dann den CBHD wie gewohnt per
  SED installieren - allerdings bisher nur auf Partitionen mit weniger als
  16 MB. (Diese EinschrÑnkung wird bald fallen.)
    
- Vortex-HDplus-Platten mit VBIOS 1.11 stellten uns vor eine weitere harte
  Probe: Sie liefen zwar prinzipiell mit CBHD, legten aber zwischen den
  Plattenzugriffen Pausen monumentaler LÑnge ein. Nach endloser Hackerei
  und einem Besuch bei Vortex (fÅr die UnterstÅtzung sei an dieser Stelle
  gedankt) stellte sich heraus, daû sich im VBIOS 1.11 ein bisher unentdeckter
  Fehler steckt, der dazu fÅhrt, daû das VBIOS auf unbekannte Kommandos
  sehr merkwÅrdig reagiert, nÑmlich indem es die besagten Gedenkminuten
  einlegt. Insbesondere passiert das, wenn man eine solche HDplus nach
  einem Plattenwechsel fragt (mittels des REQUEST-SENSE-Kommandos),
  und das tut CBHD seit der Version 3.5. (Deswegen lief der alte CBHD 3.0
  mit solchen Platten auch prÑchtig.)
  
  Ein anderes Problem ergab sich mit einer bestimmten Serie von protar-
  Platten, die mit Quantum-Laufwerken und einem fehlerhaften protar-
  Hostadapter ausgestattet sind. Quantum-Laufwerke haben die
  Eigenheit, gelegentlich von selbst die Kîpfe zu bewegen, damit sie
  nicht klebenbleiben (kein Witz!). WÑhrend dieser Zeit reagieren sie
  nicht auf Ansprache von auûen. Greift man just zu solch einem Zeitpunkt
  schreibend auf die Platte zu, gibt das Laufwerk keine Antwort, und der
  verwendete protar-Hostadapter kommt ziemlich durcheinander. Der Treiber
  bemerkt nur, daû er nach einer bestimmten Zeit keine Antwort erhÑlt,
  und bricht ab, um sich dann sogleich bei der Platte nach dem Grund des
  Fehlerschlags zu erkundigen - mittels des REQUEST-SENSE-Kommandos.
  Aufgrund seines Fehlers vermengt der protar-Hostadapter dann
  Schreibkommando und REQUEST-SENSE-Kommando zu einem einzigen, und
  heraus kommt die Aufforderung an das Quantum-Laufwerk, die ersten
  16 Sektoren der Platte zu Åberschreiben!
  
  Das bedeutet, daû damit also die Daten im Rootsektor sowie im Bootsektor
  der ersten Partition verlorengehen, und wenn man dann nicht vorher per
  SED selbige abgespeichert hat (HDX SAVE), sieht man ganz schîn alt aus.
  Was habe ich geflucht!

  Beide Gemeinheiten kann man umgehen, indem man den Treiber so
  konfiguriert, daû er bei solchen Platten nicht mehr auf einen mîglichen
  Plattenwechsel prÅft. Dies ist jetzt mîglich.
  
  Das Eigenleben der Quantum-Laufwerke fÅhrte auch dazu, daû der
  CBHD des îfteren in einen Timeout lief und daraufhin vermutete,
  es lÑge ein Datendefekt vor. Ich habe daher den betreffenden Timeout-
  Wert vergrîûert. FÅr den Normalbetrieb hat das keinerlei Auswirkungen.

- Platten, die mit einer alten Version der Eickmann-Plattensoftware
  partitioniert wurden, werden erkannt; die maximal 8 Partitionen in
  diesem Format werden korrekt eingebunden. Damit versteht der CBHD nun
  folgende Partitionsformate:
  - Altes CBHD-Format (12 Partitionen pro Laufwerk)
  - Altes ICD/SUPRA-Format (12 Partitionen)
  - Altes Vortex-Format (8 Partitionen)
  - Altes Eickmann-Format (8 Partitionen)
  - Altes AHDI-Format (4 Partitionen)
  - AHDI3-Format
  - DOS3.3-Format
  
  Seit Version 4.10 sollte CBHD auch Partitionen auf Platten
  einbinden kînnen, die auf PCs formatiert wurden. Wir haben dies
  erst kurz auf einem Syquest-Wechselmedium ausprobieren kînnen,
  das in einem PC mit der Originalsoftware von Syquest DOS3.3-
  kompatibel formatiert wurde. CBHD erkennt auch erweiterte
  DOS-Partitionen, wie sie seit DOS3.3 eingefÅhrt sind, auûerdem
  verwaltet er Partitionen mit 12-Bit-FATs richtig (TOS-
  Partitionen haben grundsÑtzlich eine 16-Bit-FAT).
  
  Vor allem mit Ñlteren TOS-Versionen kann es allerdings zu
  Schwierigkeiten kommen, da DOS-Partitionen nicht selten beispielsweise
  4 oder 8 Sektoren zu einem Cluster zusammenfassen. Laut ATARI sind
  unter TOS nur Partitionen mit zwei Sektoren pro Cluster sicher zu
  betreiben. Auûerdem kînnte es Schwierigkeiten mit sehr groûen
  DOS-Partitionen (>32 MB) geben; mangels Testmedien kînnen wir dazu
  aber noch nichts Genaues sagen. öber Erfahrungsberichte wÅrden
  wir uns sehr freuen. Wenn Sie Wechselmedien zwischen DOS und TOS
  austauschen, schreiben Sie unter TOS am besten nur auf relativ
  kleine Partitionen (unter 16 MB), um Schwierigkeiten aus dem Weg
  zu gehen. Was nicht heiût, daû nicht vielleicht auch groûe
  DOS-Partitionen problemlos gelesen und geschrieben werden kînnen.
  Wir haben's halt einfach noch nicht ausprobieren kînnen.
  
- Im CBHD existiert nun auch eine Patchtabelle am Anfang des
  Treibers, die zur Patchtabelle von AHDI3 kompatibel ist.
  Die Einstellungen, die man darin machen kann, werden allerdings
  grîûtenteils noch nicht beachtet (bisher nur def_sect_siz,
  die Voreinstellung der Sektorpuffergrîûe).

- Die Wechselbehandlung wurde optimiert und vereinfacht.

  Hat man in einer Wechselplatte beim Booten kein Medium eingelegt, wird
  diese Platte weiterhin auf einen Medienwechsel Åberwacht. Legt man dann
  wÑhrend des Betriebs ein Medium ein, werden dessen Partitionen eingebunden.
  
  Meldet eine Wechselplatte beim Zugriff, es sei nicht bereit (das passiert
  dann, wenn kein Medium eingelegt ist), fordert CBHD zum Einlegen einer
  Diskette auf. Vor dem Zugriff auf eine Wechselplatte wÑhrend des
  Wechsels ist allerdings abzuraten! Die Syquest-Laufwerke stÅrzen bei
  solchen Operationen gerne ab oder liefern irrefÅhrende Meldungen.
  
- Beim Betrieb mit Wechselplatten bekommt man unweigerlich Schwierigkeiten,
  wenn man Medien mit unterschiedlichen Partitionenanzahlen verwendet.
  Beispiel: Target 0 sei die Wechselplatte, Target 1 eine Megafile 30.
  Auf dem Medium, das momentan eingelegt ist, befinden sich drei
  Partitionen. Nun wird ein neues Medium mit fÅnf Partitionen eingelegt.
  Plîtzlich beginnen die Partitionen der Megafile 30 auf einmal nicht mehr
  ab der Kennung F, sondern H. Damit verschieben sich alle mîglichen
  Pfade, auf die sich das eine oder andere Programm verlÑût.
  
  Um diesen Effekt zu verhindern, kann man vielerlei tun:
  - nicht wechseln
  - nur Medien mit gleicher Partitionsanzahl verwenden
  - nur Programme verwenden, die keine festen Pfadeinstellungen kennen
  - die Wechselplatte die hîchste Targetnummer geben, damit deren
    Partitionen als letzte eingebunden werden
  - eine feste Anzahl von Partitionen fÅr das Wechselplattenlaufwerk
    reservieren (AHDI-Methode)
    
  Die neue CBHD-Version bietet eine andere Mîglichkeit. Hier ist es
  mîglich, den ACSI-Bus in beliebiger Reihenfolge absuchen zu lassen.
  Beispielsweise kînnte CBHD in obiger Konfiguration zuerst Target 1
  untersuchen und dessen Partitionen einbinden und erst dann Target 0
  prÅfen. Damit vermeidet man, die Anzahl der Partitionen kÅnstlich
  zu beschrÑnken, wie das AHDI tut, und gleichzeitig ist das Problem
  der wandernden Pfade behoben.
  
  Nicht nur fÅr den Betrieb von Wechselplatten ist diese Option
  praktisch. Vor allem dann, wenn mal ein Bekannter mit einer
  Platte zu Besuch kommt, und man keine Lust hat, stÑndig mit
  DIP-Schaltern herumzuspielen, um eine vernÅnftige Partitionsreihenfolge
  zu erreichen, spart diese Option viel érger und Arbeit.

- Die ersten Vorbereitungen fÅr den Betrieb am TT sind getroffen;
  insbesondere werden langsames und schnelles RAM unterschieden, und
  auch die Prozessorcaches von 68020 und 68030 werden an den nîtigen
  Stellen gelîscht. Eine richtige TT-Version wird folgen.

- Walter Marquardt, ein besonders treuer Leser, hat den grîûten
  Teil der Plattensoftware auf der KLEISTERSCHEIBE an die Billiglîsung
  der c't angepaût. Damit ist es mîglich, statt des Originaltreibers
  CBHD auf solchen Konfigurationen zu verwenden. Wer diese (noch nicht
  voll ausgetestete) Version braucht, melde sich bitte bei mir.
  
- Viele Optimierungen und kleine Korrekturen, Åber die wir nicht weiter
  reden.


Zur KompatibilitÑt von CBHD
---------------------------

Der Urvater von CBHD.SYS ist AHDI, und so verwundert es nicht, daû es
relativ wenig KompatibilitÑtsprobleme gibt. Bei der Version 3.0 gab
es Schwierigkeiten mit Programmen, die die Systemvariable bootdev
($446) abfragten und High- UND Lowbyte auswerteten (zB. MEMFILE.ACC).
Das ist ebenso abgestellt wie die meisten KalamitÑten, die CBHD 3.5
fÅr einige Programme mit sich brachte. Die Version 3.5 lehnt sich
in der Wechselbehandlung stark ans Disketten-BIOS an; dort wird eine
Wechselmeldung erzeugt, wenn ein Programm den Bootsektor einer
Diskette beschreibt. Das ist sinnvoll, und inzwischen macht es auch
ATARIs Plattentreiber so. CBHD 3.5 differierte allerdings vom Disketten-
BIOS, was den Zeitpunkt der Wechselmeldung anging. Das ist nun behoben,
so daû beispielsweise TUNEUP wieder lÑuft. Ob auch die Restore-Funktion
in FCOPY 3 dadurch wieder ihren Dienst tut, haben wir nicht getestet,
aber es ist wahrscheinlich.

Dann ist da noch unser spezielles Rootsektorformat fÅr 12 Partitionen.
Zwar ist dieses sehr verbreitet (ICD- und SUPRA-Treiber verwenden das
gleiche Format), aber nicht alle Programme kommen mit mehr Partitionen
zurecht. Klassisches Beispiel ist eine frÅhere Version des Kuma-RCS,
das in einer Schleife fÅr alle aktiven Partitionen Icons auf den
Bildschirm malte; wenn es mehr als 6 Partitionen gab, malte das Programm
eben einfach mal Åber den Bildschirm hinaus, mitten in den wabernden
und undefinierten Datenbus hinein (-> Bîmbchen).

Das 12-Partitionen-Format wollen wir weiter unterstÅtzen, weil es einfach
zu begreifen, zu programmieren und zu reparieren (!) ist. Seit der
KLEISTERSCHEIBE V2.33 unterstÅtzt CBHD nun auch das AHDI3-Format.
Leider ist die aktuelle SED-Version wegen radikalen Umbaus fÅr 
die ôffentlichkeit noch geschlossen, so daû Sie einstweilen, wie
oben angedeutet, auf andere Partitionierer zurÅckgreifen mÅssen.

Auch mit den gÑngigen Emulatoren kommt CBHD gut zurecht:
    Pc-ditto
    SuperCharger
    Spectre
    ATonce

Nur auf den ersten vier Partitionen wollten sich beim letzten
Test die folgenden Emulatoren niederlassen:
    PCSpeed (und wahrscheinlich dann auch ATSpeed?)
    ALADIN (in dessen Platteninstallierprogramm soll man den Offset
            fÅr erweiterte RootsektoreintrÑge setzen und damit auch
            die erweiterten Partitionen nutzen kînnen - der Offset
            der zusÑtzlichen Partitionentabelle im Rootsektor ist bei
            CBHD $156, dez. 342)

Auch mit dem QL-Emulator soll sich CBHD gut vertragen.


Installation des neuen Treibers
-------------------------------

Wenn Sie Ihre Platte schon mit CBHD.SYS bootfÑhig gemacht haben,
genÅgt es, ihn einfach gegen den neuen Treiber auszutauschen (CBHD.SYS
von Diskette auf bootfÑhige Partition kopieren, alten Treiber Åber-
schreiben). éhnliches gilt Åbrigens, wenn Sie Ihre Platte mit AHDI1.7
bootfÑhig gemacht haben und nicht mehr als vier Partitionen nutzen
wollen: Benennen Sie CBHD.SYS (oder CBHDxxx.PRG) in SHDRIVER.SYS um
und kopieren Sie es in die Bootpartition.

Ansonsten lÑuft die Installation ganz normal per SED ab (siehe dort).
Wenn Sie mit einem anderen Programm partitioniert haben: Beachten
Sie bitte, daû SED 4.67 den Treiber bisher _nur_ auf Partitionen
mit maximal 16 MB Grîûe installieren kann.

****************
* CBHDINST 2.4 *
****************

- komplett in Assembler umgeschrieben von Markus Fritze, einem der
  Programmierer des OMIKRON.Assemblers. DafÅr immerwÑhrenden Dank!
  Der Assemblerquelltext liegt auf der KLEISTERSCHEIBE vor (entschÑrftes
  TurboAss-Format, sollten andere Assembler auch einigermaûen
  verstehen).

- RSC-Datei im Programm integriert

- belegt nur noch 10 KB auf Disk und 14 KB im Speicher (vorher schluckte
  es - weil in GFABASIC geschrieben - 130 KB als Accessory)

- Option RESET: Der Kaltstart lîscht gleichzeitig den gesamten Speicher
  (kÑlter geht's nimmer)

- grundsÑtzlich kînnen nun alle GerÑte geparkt oder entparkt werden,
  auch wenn sie beim Start nicht einwandfrei erkannt wurden

- Fehlerkorrekturen, Anpassung an CBHD 3.8

- ab dieser Version liegt zusÑtzlich die in C konvertierte Version
  namens CBHDCONF bei. Sie ist fast so schîn kurz wie die Assemblerversion,
  dafÅr aber wesentlich besser zu warten, und auûerdem unterstÅtzt sie
  die neuen Konfigurationsmîglichkeiten des CBHD 4.x.
  
****************
* CHECKHD V8.3 *
****************

Eine Kurzanleitung dazu findet im Archiv KAP14.LZH.

**********
* STEPxy *
**********

- benutzt ab TOS 1.04 die neue XBIOS-Funktion Floprate (XBIOS 41, siehe
  FORMAT10.LST)

- Das Format der Kommandozeile hat sich geÑndert:
     stepxy xy
     mit x=0,1,2,3 und y=0,1,2,3
     
     
********************
* HYPERFORMAT 3.28 *
********************

- Settling delay lÑût sich nun wirklich einstellen (sorry)

- LÅckengrîûen verÑndert, insbesondere beim 11-Sektor-Format

- Ausstieg nun auch ohne Disk in A: mîglich

- ACC meldet Speichermangel beim Aufruf per Alertbox

- Passiert beim Schreiben des Diskettennamens ein Fehler, erscheint
  eine Alertbox und der Mauszeiger BLEIBT AN (wow...)!

- Dem Accessory HYDSEL.ACC zum Umschalten auf HYPER DENSITY wird nun
  die Gelegenheit zum Umschalten gegeben (lief vorher nicht, weil
  HYPERFORMAT ausschlieûlich eigene Floppyroutinen einsetzte)

- mit F10 kann man den Zustand des Bits 6 im Port A des Soundchips
  direkt umschalten (Anzeige: "+" = Bit gesetzt, also HYPER DENSITY
  an), wenn man sich nicht auf HYDSEL.ACC verlassen will. Dadurch
  sind andererseits auch Formate mit weniger als 12 Sektoren im
  HYPER-DENSITY-Modus mîglich (wer's braucht...). Das Bit wird
  beim Ausstieg aus HYPERFORMAT nicht mehr geÑndert, es bleibt also
  so, wie Sie's eingestellt haben.

- neue Funktionstastenbelegung:
  F1: TOS 1S, einseitiges 9-Sektor-Format
  F2: TOS 2S, zweiseitiges 9-Sektor-Format
  F3: FAT 2S, zweiseitiges 10-Sektor-Format
  F4: HYPER,  zweiseitiges 11-Sektor-Format
  F5: DOS 2S, zweiseitiges DOS-Format, 40 Spuren
  F6: 1.1 MB, zweiseitiges 13-Sektoren-Format (HYPER DENSITY)
  F7: 1.2 MB, zweiseitiges 14-Sektoren-Format (HYPER DENSITY)
  F8: AT-Fmt, zweiseitiges AT-kompatibles 15-Sektoren-Format
              (nur auf HD-Laufwerken)
  F9: 1.4 MB, zweiseitiges PS/2-kompatibles 18-Sektoren-Format
              (nur auf 3.5"-HD-Laufwerken)
  F10: HD-Flag, Umschaltung des HD-Bits im Soundchip, s.o.

- Richtig gelesen, HYPERFORMAT kann jetzt High-Density-Formate schreiben,
  die kompatibel zu den 1.2MB/1.44MB-Laufwerken der PS/2-Rechner und ATs
  sind!!!!!!! Mehr noch: Auf 5.25"-HD-Disketten passen ***17 SEKTOREN***
  (=1.4 MB bei 83 Spuren), auf 3.5"-HD-Disketten sogar ***21 SEKTOREN***
  pro Spur (=1.7 MB bei 83 Spuren)! Das geht freilich nur, wenn Sie Ihren
  Floppycontroller etwas aufrÅsten und ein HD-Laufwerk besitzen (z.B.
  TEAC F55GFR oder TEAC FD235HF). Wie das geht, werden wir in der
  "ST-Computer" ausfÅhrlich beschreiben. Die Kosten sind minimal
  (10 Mark, ohne HD-Laufwerk natÅrlich), und der Umbau ist SEHR einfach.
  Lassen Sie sich Åberraschen.

  Den Anstoû fÅr die HD-Geschichte kommt von Joachim Bohs aus Berlin.
  Die ST-Gemeinde wird es ihm sicher danken.

  Nun kînnen Sie also auf dem ST Disketten formatieren, die Sie in einem
  AT oder PS/2-Rechner ins HD-Laufwerk schieben und bearbeiten kînnen.
  Umgekehrt kann der ST auch HD-Disketten der PCs lesen und schreiben.
  Und HYPERFORMAT ist - wie immer - das erste Programm, das dies
  unterstÅtzt, und mehr noch: Damit sind auf 3.5"-HD-Disketten 1.7 MB
  unterzubringen, mehr, als das DoMeSDOS-Rechner je kînnen.

  HYPERFORMAT beachtet Åbrigens auch bei HD-Disketten die Microsoft-
  Richtlinien fÅr das Formatieren von MS-DOS-kompatiblen Disketten
  (auûer bei ausfÅhrbaren ST-Bootsektoren). Wenn solche Disketten
  in PCs nicht einwandfrei laufen, liegt das NICHT am ST oder an
  HYPERFORMAT, sondern nur daran, daû sich das Disketten-BIOS der
  meisten PCs sich nicht an die Microsoft-Vorgaben hÑlt. Auch unter
  TOS 1.4 im Desktop formatierte Disks SIND definitiv DOS-kompatibel -
  wenn's nicht lÑuft, hat das triviale GrÅnde (Steprate etc.) oder
  aber das Disketten-BIOS im PC spinnt. In solchen NotfÑllen formatiere
  man die Disketten auf dem PC und verwende sie auf dem ST - der ist
  beim Auslesen der Bootsektorparameter DOS-kompatibler als die meisten
  PCs...

  21-Sektor-Disks laufen nicht mehr mit Interleave 1; man stelle hier
  einen Interleavefaktor 11 und Spiralfaktor 3 ein. Damit erreicht man
  immer noch eine Transferrate, die hîher liegt als bei gewîhnlichen
  9- oder 10-Sektor-Disketten.
 
- Default-Parameter bei HYPER-DENSITY-Formaten geÑndert (Steprate 6ms)

- spezielles Zusatzprogramm GAPS zur Einstellung der LÅckengrîûen in
  HYPERFORMAT V3.27 - wer selbst an den LÅcken herumspielen will, kann
  das nun tun, auf eigene Gefahr selbstverstÑndlich. Hinweise zu
  vernÅnftigen LÅckenÑnderungen entnehme man dem SCHEIBENKLEISTER.
  Praktisch auch zur individuellen Anpassung des 11-Sektor-Formats
  an kritische Laufwerke. Das Programm erklÑrt sich selbst und ist
  (bisher) NUR fÅr HYPERFORMAT 3.27 gedacht!
  
- In GEMINI kann man HYPFM327.ACC per Doppelklick aufrufen.

- HYPFM327 lÑuft nun besser unter OverScan. Die Anpassung ist wahrlich
  nicht perfekt, nicht einmal gut, aber es funktioniert - und eine richtige
  GEM-Version ist im Anrollen!

- seit HYPFM328 lassen sich auf HD-Disketten auch 22 Sektoren pro
  Spur formatieren
  
************
* CACHEADD *
************

- holt sich aktuelle Sektorpuffergrîûe nach ATARI-Richtlinien von
  AHDI 3.0x oder kompatiblem Treiber (wenn installiert)

- Sektorpuffergrîûe auch per Dateiname einstellbar

- Option zum Entfernen der vorher installierten GEMDOS-Pufferliste
  (Achtung! Vorher Medienwechsel auf allen Laufwerken auslîsen!)

- neues Dateinamen-Format:
       CACyTxxx
         ||||||
         |||---------Anzahl der zusÑtzlichen Puffersektoren
         ||----------Puffertyp (D(ata)/F(at)/B(eide))
         |-------------"H": Puffergrîûe = 512 Bytes bzw. von AHDI holen
         |             Ziffer von 1..7: Puffergrîûe von Hand einstellen
         |             (1 = 512 Bytes, 2 = 1024 B., 3 = 2048 B., 4 = 4096 B.,
         |              5 = 8192 B., 6 = 16384 B., 7 = 32768 B.)
         --------------"C": alte Pufferliste einbinden
                       sonst: alte Pufferliste wegwerfen, nur neue
                       installieren

        CADHB100    100 Puffersektoren auf beide Listen verteilen, alte
                    Pufferliste entfernen
        CAD2B100    neue Pufferliste mit 100 Puffersektoren (Fat- und
                    Data-Liste zusammen) mit 1024 Bytes Grîûe installieren

*********
*VIRKILL*
*********

VIRKILL hatten wir damals auf die KLEISTERSCHEIBE geworfen, um prinzipiell
zu zeigen, wie man Bootsektorviren erkennt. Da damals (Anfang 1988) nur
wenige Viren bekannt waren, reagierte VIRKILL auch nur auf drei solche
FrÅchte pervertierten Denkens und diente daher nur als Demo.

Unser altgedienter Leser Marcus Klocke-Sewing hat sich dieses
Programmes nun erbarmt und ihm beigebracht, das eine oder andere
Virus zusÑtzlich zu erkennen. FÅr seine Arbeit sei ihm gedankt.

Nun werden die folgenden Bootsektorviren erkannt:

	Signum/BPL-Virus
	Ghost-Virus
	Verdunkler-Virus
	VDU-Virus
	Speicher-Virus
	Rambo-Virus
	Mad Virus
	Laxy-Virus
	Vire 87 Virus

Auch werden folgende Immunsektoren erkannt:

	Sagrotan-Bootsektor
	Bootsektor des "Anti-Viren-Kits"

Nebenbei ist es mîglich, Disketten mit einem (sehr einfachen)
Virenschutz zu versehen. SAGROTAN oder VDU (bzw. AVK, wie es nun
heiût) kann VIRKILL bei weitem nicht ersetzen, aber es ist doch
schon einmal ein Anfang.


*****************
* KLEINIGKEITEN *
*****************

BHDI1.3:
- lÑuft nun komplett mit HYPERCACHE (auch ReqSense)
  (macht sich in SED und CD-Moni bemerkbar)
- Fehler beim Kommando RECEIVE DIAGNOSTIC behoben

VARIO313:
- Fehler beim Kopieren von Partitionen in mehreren DurchgÑngen entfernt

FORMAT10:
- Binding fÅr neue XBIOS-Funktion Floprate (XBIOS 41, ab TOS 1.04)

PROTECT:
- Trackverify nach Kopfbewegung auf Spur 41 hilft bei tattrigen
  Laufwerken
  
LUFTSCHLOSS:
- Fehler bei öbertragung an ungerade Adressen behoben (trat im tÑglichen
  Gebrauch nicht auf, sondern bisher nur bei einem Benchmark-Programm)
- Anpassung an 1040STE, TT und MegaSTE
- Assemblierflag fÅr 12- oder 16-Bit-FAT
- Umstellung auf TurboAss
- Das Luftschloss simuliert nun einen Bootsektor, damit Programme wie
  Neodesk beim Zugriff nicht vîllig verwirrte Fragen stellen; fÅr
  diese Verbesserung herzlichen Dank an T. Lang
- Sollte bei unbekannten TOS-Versionen, dank der getmpb-Routine
  von Bernd Rosenlecher, wesentlich kooperativer sein
  
----------------------------------------------------------------------
Bei Fragen, Unklarheiten, Problemen, RÅckmeldungen, VorschlÑgen, Ideen
wende mensch sich an

    Claus Brod, Am Felsenkeller 2, 8772 Marktheidenfeld
oder
    Anton Stepper, Jahnstraûe 5, 8772 Marktheidenfeld

